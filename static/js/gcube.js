!function(){var t={};!function(){function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i}t.prototype=window.Event.prototype,window.CustomEvent=t,Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},r=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,r.prototype=new n,r})}(),t.extend=function(t,e){if(Object.keys)for(var i=Object.keys(e),n=0,r=i.length;r>n;n++){var s=i[n];Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(e,s))}else for(s in i={}.hasOwnProperty,e)i.call(e,s)&&(t[s]=e[s]);return t},void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var e=e||function(){var t=[];return{REVISION:"12",getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){e=t.indexOf(e),-1!==e&&t.splice(e,1)},update:function(e){if(0===t.length)return!1;var i=0;for(e=void 0!==e?e:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();i<t.length;)t[i].update(e)?i++:t.splice(i,1);return!0}}}();e.Tween=function(t){var i,n={},r={},s={},o=1e3,a=0,h=!1,c=!1,u=0,l=null,d=e.Easing.Linear.None,f=e.Interpolation.Linear,m=[],p=null,y=!1,x=null,v=null;for(i in t)n[i]=parseFloat(t[i],10);this.to=function(t,e){return void 0!==e&&(o=e),r=t,this},this.start=function(i){e.add(this),c=!0,y=!1,l=void 0!==i?i:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),l+=u;for(var o in r){if(r[o]instanceof Array){if(0===r[o].length)continue;r[o]=[t[o]].concat(r[o])}n[o]=t[o],!1==n[o]instanceof Array&&(n[o]*=1),s[o]=n[o]||0}return this},this.stop=function(){return c?(e.remove(this),c=!1,this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var t=0,e=m.length;e>t;t++)m[t].stop()},this.delay=function(t){return u=t,this},this.repeat=function(t){return a=t,this},this.yoyo=function(t){return h=t,this},this.easing=function(t){return d=t,this},this.interpolation=function(t){return f=t,this},this.chain=function(){return m=arguments,this},this.onStart=function(t){return p=t,this},this.onUpdate=function(t){return x=t,this},this.onComplete=function(t){return v=t,this},this.update=function(e){var i;if(l>e)return!0;!1===y&&(null!==p&&p.call(t),y=!0);var c=(e-l)/o,c=c>1?1:c,w=d(c);for(i in r){var g=n[i]||0,b=r[i];b instanceof Array?t[i]=f(b,w):("string"==typeof b&&(b=g+parseFloat(b,10)),"number"==typeof b&&(t[i]=g+(b-g)*w))}if(null!==x&&x.call(t,w),1==c){if(!(a>0)){for(null!==v&&v.call(t),i=0,c=m.length;c>i;i++)m[i].start(e);return!1}isFinite(a)&&a--;for(i in s)"string"==typeof r[i]&&(s[i]+=parseFloat(r[i],10)),h&&(c=s[i],s[i]=r[i],r[i]=c),n[i]=s[i];l=e+u}return!0}},e.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return 1>(t*=2)?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return 1>(t*=2)?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return 1>(t*=2)?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return 1>(t*=2)?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:1>(t*=2)?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return 1>(t*=2)?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)))},Out:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/.4)+1)},InOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),1>(t*=2)?-.5*i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4):i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*.5+1)}},Back:{In:function(t){return t*t*(2.70158*t-1.70158)},Out:function(t){return--t*t*(2.70158*t+1.70158)+1},InOut:function(t){return 1>(t*=2)?.5*t*t*(3.5949095*t-2.5949095):.5*((t-=2)*t*(3.5949095*t+2.5949095)+2)}},Bounce:{In:function(t){return 1-e.Easing.Bounce.Out(1-t)},Out:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return.5>t?.5*e.Easing.Bounce.In(2*t):.5*e.Easing.Bounce.Out(2*t-1)+.5}}},e.Interpolation={Linear:function(t,i){var n=t.length-1,r=n*i,s=Math.floor(r),o=e.Interpolation.Utils.Linear;return 0>i?o(t[0],t[1],r):i>1?o(t[n],t[n-1],n-r):o(t[s],t[s+1>n?n:s+1],r-s)},Bezier:function(t,i){var n,r=0,s=t.length-1,o=Math.pow,a=e.Interpolation.Utils.Bernstein;for(n=0;s>=n;n++)r+=o(1-i,s-n)*o(i,n)*t[n]*a(s,n);return r},CatmullRom:function(t,i){var n=t.length-1,r=n*i,s=Math.floor(r),o=e.Interpolation.Utils.CatmullRom;return t[0]===t[n]?(0>i&&(s=Math.floor(r=n*(1+i))),o(t[(s-1+n)%n],t[s],t[(s+1)%n],t[(s+2)%n],r-s)):0>i?t[0]-(o(t[0],t[0],t[1],t[1],-r)-t[0]):i>1?t[n]-(o(t[n],t[n],t[n-1],t[n-1],r-n)-t[n]):o(t[s?s-1:0],t[s],t[s+1>n?n:s+1],t[s+2>n?n:s+2],r-s)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,i){var n=e.Interpolation.Utils.Factorial;return n(t)/n(i)/n(t-i)},Factorial:function(){var t=[1];return function(e){var i,n=1;if(t[e])return t[e];for(i=e;i>1;i--)n*=i;return t[e]=n}}(),CatmullRom:function(t,e,i,n,r){t=.5*(i-t),n=.5*(n-e);var s=r*r;return(2*e-2*i+t+n)*r*s+(-3*e+3*i-2*t-n)*s+t*r+e}}};var i={REVISION:"66"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!self.requestAnimationFrame;++i)self.requestAnimationFrame=self[e[i]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[e[i]+"CancelAnimationFrame"]||self[e[i]+"CancelRequestAnimationFrame"];void 0===self.requestAnimationFrame&&void 0!==self.setTimeout&&(self.requestAnimationFrame=function(e){var i=Date.now(),n=Math.max(0,16-(i-t)),r=self.setTimeout(function(){e(i+n)},n);return t=i+n,r}),void 0===self.cancelAnimationFrame&&void 0!==self.clearTimeout&&(self.cancelAnimationFrame=function(t){self.clearTimeout(t)})}(),i.CullFaceNone=0,i.CullFaceBack=1,i.CullFaceFront=2,i.CullFaceFrontBack=3,i.FrontFaceDirectionCW=0,i.FrontFaceDirectionCCW=1,i.BasicShadowMap=0,i.PCFShadowMap=1,i.PCFSoftShadowMap=2,i.FrontSide=0,i.BackSide=1,i.DoubleSide=2,i.NoShading=0,i.FlatShading=1,i.SmoothShading=2,i.NoColors=0,i.FaceColors=1,i.VertexColors=2,i.NoBlending=0,i.NormalBlending=1,i.AdditiveBlending=2,i.SubtractiveBlending=3,i.MultiplyBlending=4,i.CustomBlending=5,i.AddEquation=100,i.SubtractEquation=101,i.ReverseSubtractEquation=102,i.ZeroFactor=200,i.OneFactor=201,i.SrcColorFactor=202,i.OneMinusSrcColorFactor=203,i.SrcAlphaFactor=204,i.OneMinusSrcAlphaFactor=205,i.DstAlphaFactor=206,i.OneMinusDstAlphaFactor=207,i.DstColorFactor=208,i.OneMinusDstColorFactor=209,i.SrcAlphaSaturateFactor=210,i.MultiplyOperation=0,i.MixOperation=1,i.AddOperation=2,i.UVMapping=function(){},i.CubeReflectionMapping=function(){},i.CubeRefractionMapping=function(){},i.SphericalReflectionMapping=function(){},i.SphericalRefractionMapping=function(){},i.RepeatWrapping=1e3,i.ClampToEdgeWrapping=1001,i.MirroredRepeatWrapping=1002,i.NearestFilter=1003,i.NearestMipMapNearestFilter=1004,i.NearestMipMapLinearFilter=1005,i.LinearFilter=1006,i.LinearMipMapNearestFilter=1007,i.LinearMipMapLinearFilter=1008,i.UnsignedByteType=1009,i.ByteType=1010,i.ShortType=1011,i.UnsignedShortType=1012,i.IntType=1013,i.UnsignedIntType=1014,i.FloatType=1015,i.UnsignedShort4444Type=1016,i.UnsignedShort5551Type=1017,i.UnsignedShort565Type=1018,i.AlphaFormat=1019,i.RGBFormat=1020,i.RGBAFormat=1021,i.LuminanceFormat=1022,i.LuminanceAlphaFormat=1023,i.RGB_S3TC_DXT1_Format=2001,i.RGBA_S3TC_DXT1_Format=2002,i.RGBA_S3TC_DXT3_Format=2003,i.RGBA_S3TC_DXT5_Format=2004,i.EventDispatcher=function(){},i.EventDispatcher.prototype={constructor:i.EventDispatcher,apply:function(t){t.addEventListener=i.EventDispatcher.prototype.addEventListener,t.hasEventListener=i.EventDispatcher.prototype.hasEventListener,t.removeEventListener=i.EventDispatcher.prototype.removeEventListener,t.dispatchEvent=i.EventDispatcher.prototype.dispatchEvent},addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)?!0:!1},removeEventListener:function(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i){var n=i.indexOf(e);-1!==n&&i.splice(n,1)}}},dispatchEvent:function(){var t=[];return function(e){if(void 0!==this._listeners){var i=this._listeners[e.type];if(void 0!==i){e.target=this;for(var n=i.length,r=0;n>r;r++)t[r]=i[r];for(r=0;n>r;r++)t[r].call(this,e)}}}}()},i.Math={PI2:2*Math.PI,generateUUID:function(){var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=Array(36),n=0;return function(){for(var r=0;36>r;r++)8==r||13==r||18==r||23==r?i[r]="-":14==r?i[r]="4":(2>=n&&(n=33554432+16777216*Math.random()|0),t=15&n,n>>=4,i[r]=e[19==r?3&t|8:t]);return i.join("")}}(),clamp:function(t,e,i){return e>t?e:t>i?i:t},clampBottom:function(t,e){return e>t?e:t},mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},smoothstep:function(t,e,i){return e>=t?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))},smootherstep:function(t,e,i){return e>=t?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(6*t-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},sign:function(t){return 0>t?-1:t>0?1:0},degToRad:function(){var t=Math.PI/180;return function(e){return e*t}}(),radToDeg:function(){var t=180/Math.PI;return function(e){return e*t}}(),isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t}},i.Quaternion=function(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==n?n:1},i.Quaternion.prototype={constructor:i.Quaternion,_x:0,_y:0,_z:0,_w:0,_euler:void 0,_updateEuler:function(){void 0!==this._euler&&this._euler.setFromQuaternion(this,void 0,!1)},get x(){return this._x},set x(t){this._x=t,this._updateEuler()},get y(){return this._y},set y(t){this._y=t,this._updateEuler()},get z(){return this._z},set z(t){this._z=t,this._updateEuler()},get w(){return this._w},set w(t){this._w=t,this._updateEuler()},set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._updateEuler(),this},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._w=t._w,this._updateEuler(),this},setFromEuler:function(t,e){if(!1==t instanceof i.Euler)throw Error("ERROR: Quaternion's .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var n=Math.cos(t._x/2),r=Math.cos(t._y/2),s=Math.cos(t._z/2),o=Math.sin(t._x/2),a=Math.sin(t._y/2),h=Math.sin(t._z/2);return"XYZ"===t.order?(this._x=o*r*s+n*a*h,this._y=n*a*s-o*r*h,this._z=n*r*h+o*a*s,this._w=n*r*s-o*a*h):"YXZ"===t.order?(this._x=o*r*s+n*a*h,this._y=n*a*s-o*r*h,this._z=n*r*h-o*a*s,this._w=n*r*s+o*a*h):"ZXY"===t.order?(this._x=o*r*s-n*a*h,this._y=n*a*s+o*r*h,this._z=n*r*h+o*a*s,this._w=n*r*s-o*a*h):"ZYX"===t.order?(this._x=o*r*s-n*a*h,this._y=n*a*s+o*r*h,this._z=n*r*h-o*a*s,this._w=n*r*s+o*a*h):"YZX"===t.order?(this._x=o*r*s+n*a*h,this._y=n*a*s+o*r*h,this._z=n*r*h-o*a*s,this._w=n*r*s-o*a*h):"XZY"===t.order&&(this._x=o*r*s-n*a*h,this._y=n*a*s-o*r*h,this._z=n*r*h+o*a*s,this._w=n*r*s+o*a*h),!1!==e&&this._updateEuler(),this},setFromAxisAngle:function(t,e){var i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._updateEuler(),this},setFromRotationMatrix:function(t){var e=t.elements,i=e[0];t=e[4];var n=e[8],r=e[1],s=e[5],o=e[9],a=e[2],h=e[6],e=e[10],c=i+s+e;return c>0?(i=.5/Math.sqrt(c+1),this._w=.25/i,this._x=(h-o)*i,this._y=(n-a)*i,this._z=(r-t)*i):i>s&&i>e?(i=2*Math.sqrt(1+i-s-e),this._w=(h-o)/i,this._x=.25*i,this._y=(t+r)/i,this._z=(n+a)/i):s>e?(i=2*Math.sqrt(1+s-i-e),this._w=(n-a)/i,this._x=(t+r)/i,this._y=.25*i,this._z=(o+h)/i):(i=2*Math.sqrt(1+e-i-s),this._w=(r-t)/i,this._x=(n+a)/i,this._y=(o+h)/i,this._z=.25*i),this._updateEuler(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._updateEuler(),this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._z=this._y=this._x=0,this._w=1):(t=1/t,this._x*=t,this._y*=t,this._z*=t,this._w*=t),this},multiply:function(t,e){return void 0!==e?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,e){var i=t._x,n=t._y,r=t._z,s=t._w,o=e._x,a=e._y,h=e._z,c=e._w;return this._x=i*c+s*o+n*h-r*a,this._y=n*c+s*a+r*o-i*h,this._z=r*c+s*h+i*a-n*o,this._w=s*c-i*o-n*a-r*h,this._updateEuler(),this},multiplyVector3:function(t){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},slerp:function(t,e){var i=this._x,n=this._y,r=this._z,s=this._w,o=s*t._w+i*t._x+n*t._y+r*t._z;if(0>o?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;var a=Math.acos(o),h=Math.sqrt(1-o*o);return.001>Math.abs(h)?(this._w=.5*(s+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this):(o=Math.sin((1-e)*a)/h,a=Math.sin(e*a)/h,this._w=s*o+this._w*a,this._x=i*o+this._x*a,this._y=n*o+this._y*a,this._z=r*o+this._z*a,this._updateEuler(),this)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],this._w=t[3],this._updateEuler(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},clone:function(){return new i.Quaternion(this._x,this._y,this._z,this._w)}},i.Quaternion.slerp=function(t,e,i,n){return i.copy(t).slerp(e,n)},i.Vector2=function(t,e){this.x=t||0,this.y=e||0},i.Vector2.prototype={constructor:i.Vector2,set:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScalar:function(t){return this.x+=t,this.y+=t,this},sub:function(t,e){return void 0!==e?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divideScalar:function(t){return 0!==t?(t=1/t,this.x*=t,this.y*=t):this.y=this.x=0,this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this},clampScalar:function(){var t,e;return function(n,r){return void 0===t&&(t=new i.Vector2,e=new i.Vector2),t.set(n,n),e.set(r,r),this.clamp(t,e)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x;return t=this.y-t.y,e*e+t*t},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t){return this.x=t[0],this.y=t[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new i.Vector2(this.x,this.y)}},i.Vector3=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0},i.Vector3.prototype={constructor:i.Vector3,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},sub:function(t,e){return void 0!==e?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(){var t;return function(e){return!1==e instanceof i.Euler&&console.error("ERROR: Vector3's .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code."),void 0===t&&(t=new i.Quaternion),this.applyQuaternion(t.setFromEuler(e)),this}}(),applyAxisAngle:function(){var t;return function(e,n){return void 0===t&&(t=new i.Quaternion),this.applyQuaternion(t.setFromAxisAngle(e,n)),this}}(),applyMatrix3:function(t){var e=this.x,i=this.y,n=this.z;return t=t.elements,this.x=t[0]*e+t[3]*i+t[6]*n,this.y=t[1]*e+t[4]*i+t[7]*n,this.z=t[2]*e+t[5]*i+t[8]*n,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z;return t=t.elements,this.x=t[0]*e+t[4]*i+t[8]*n+t[12],this.y=t[1]*e+t[5]*i+t[9]*n+t[13],this.z=t[2]*e+t[6]*i+t[10]*n+t[14],this},applyProjection:function(t){var e=this.x,i=this.y,n=this.z;t=t.elements;var r=1/(t[3]*e+t[7]*i+t[11]*n+t[15]);return this.x=(t[0]*e+t[4]*i+t[8]*n+t[12])*r,this.y=(t[1]*e+t[5]*i+t[9]*n+t[13])*r,this.z=(t[2]*e+t[6]*i+t[10]*n+t[14])*r,this},applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,o=t.z;t=t.w;var a=t*e+s*n-o*i,h=t*i+o*e-r*n,c=t*n+r*i-s*e,e=-r*e-s*i-o*n;return this.x=a*t+e*-r+h*-o-c*-s,this.y=h*t+e*-s+c*-r-a*-o,this.z=c*t+e*-o+a*-s-h*-r,this},transformDirection:function(t){var e=this.x,i=this.y,n=this.z;return t=t.elements,this.x=t[0]*e+t[4]*i+t[8]*n,this.y=t[1]*e+t[5]*i+t[9]*n,this.z=t[2]*e+t[6]*i+t[10]*n,this.normalize(),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return 0!==t?(t=1/t,this.x*=t,this.y*=t,this.z*=t):this.z=this.y=this.x=0,this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z),this},clampScalar:function(){var t,e;return function(n,r){return void 0===t&&(t=new i.Vector3,e=new i.Vector3),t.set(n,n,n),e.set(r,r,r),this.clamp(t,e)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},cross:function(t,e){if(void 0!==e)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e);var i=this.x,n=this.y,r=this.z;return this.x=n*t.z-r*t.y,this.y=r*t.x-i*t.z,this.z=i*t.y-n*t.x,this},crossVectors:function(t,e){var i=t.x,n=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=n*a-r*o,this.y=r*s-i*a,this.z=i*o-n*s,this},projectOnVector:function(){var t,e;return function(n){return void 0===t&&(t=new i.Vector3),t.copy(n).normalize(),e=this.dot(t),this.copy(t).multiplyScalar(e)}}(),projectOnPlane:function(){var t;return function(e){return void 0===t&&(t=new i.Vector3),t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t;return function(e){return void 0===t&&(t=new i.Vector3),this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){return t=this.dot(t)/(this.length()*t.length()),Math.acos(i.Math.clamp(t,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return t=this.z-t.z,e*e+i*i+t*t},setEulerFromRotationMatrix:function(){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(t){return console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),this.setFromMatrixColumn(t,e)},setFromMatrixPosition:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this},setFromMatrixScale:function(t){var e=this.set(t.elements[0],t.elements[1],t.elements[2]).length(),i=this.set(t.elements[4],t.elements[5],t.elements[6]).length();return t=this.set(t.elements[8],t.elements[9],t.elements[10]).length(),this.x=e,this.y=i,this.z=t,this},setFromMatrixColumn:function(t,e){var i=4*t,n=e.elements;return this.x=n[i],this.y=n[i+1],this.z=n[i+2],this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new i.Vector3(this.x,this.y,this.z)}},i.Box3=function(t,e){this.min=void 0!==t?t:new i.Vector3(1/0,1/0,1/0),this.max=void 0!==e?e:new i.Vector3(-1/0,-1/0,-1/0)},i.Box3.prototype={constructor:i.Box3,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},addPoint:function(t){t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)},setFromPoints:function(t){if(0<t.length){var e=t[0];this.min.copy(e),this.max.copy(e);for(var e=1,i=t.length;i>e;e++)this.addPoint(t[e])}else this.makeEmpty();return this},setFromCenterAndSize:function(){var t=new i.Vector3;return function(e,i){var n=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),setFromObject:function(){var t=new i.Vector3;return function(e){var i=this;return e.updateMatrixWorld(!0),this.makeEmpty(),e.traverse(function(e){if(void 0!==e.geometry&&void 0!==e.geometry.vertices)for(var n=e.geometry.vertices,r=0,s=n.length;s>r;r++)t.copy(n[r]),t.applyMatrix4(e.matrixWorld),i.expandByPoint(t)}),this}}(),copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){return(t||new i.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new i.Vector3).subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z?!1:!0},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z?!0:!1},getParameter:function(t,e){return(e||new i.Vector3).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(t){return t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z?!1:!0},clampPoint:function(t,e){return(e||new i.Vector3).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new i.Vector3;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new i.Vector3;return function(e){return e=e||new i.Sphere,e.center=this.center(),e.radius=.5*this.size(t).length(),e}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(){var t=[new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3];return function(e){return t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(t),this}}(),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},clone:function(){return(new i.Box3).copy(this)}},i.Sphere=function(t,e){this.center=void 0!==t?t:new i.Vector3,this.radius=void 0!==e?e:0},i.Sphere.prototype={constructor:i.Sphere,set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t=new i.Box3;return function(e,i){var n=this.center;void 0!==i?n.copy(i):t.setFromPoints(e).center(n);for(var r=0,s=0,o=e.length;o>s;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}}(),copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},clampPoint:function(t,e){var n=this.center.distanceToSquared(t),r=e||new i.Vector3;return r.copy(t),n>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(t){return t=t||new i.Box3,t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius*=t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius},clone:function(){return(new i.Sphere).copy(this)}},i.Euler=function(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._order=r||i.Euler.DefaultOrder},i.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),i.Euler.DefaultOrder="XYZ",i.Euler.prototype={constructor:i.Euler,_x:0,_y:0,_z:0,_order:i.Euler.DefaultOrder,_quaternion:void 0,_updateQuaternion:function(){void 0!==this._quaternion&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(t){this._x=t,this._updateQuaternion()},get y(){return this._y},set y(t){this._y=t,this._updateQuaternion()},get z(){return this._z},set z(t){this._z=t,this._updateQuaternion()},get order(){return this._order},set order(t){this._order=t,this._updateQuaternion()},set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._order=n||this._order,this._updateQuaternion(),this
},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._updateQuaternion(),this},setFromRotationMatrix:function(t,e){function i(t){return Math.min(Math.max(t,-1),1)}var n=t.elements,r=n[0],s=n[4],o=n[8],a=n[1],h=n[5],c=n[9],u=n[2],l=n[6],n=n[10];return e=e||this._order,"XYZ"===e?(this._y=Math.asin(i(o)),.99999>Math.abs(o)?(this._x=Math.atan2(-c,n),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(l,h),this._z=0)):"YXZ"===e?(this._x=Math.asin(-i(c)),.99999>Math.abs(c)?(this._y=Math.atan2(o,n),this._z=Math.atan2(a,h)):(this._y=Math.atan2(-u,r),this._z=0)):"ZXY"===e?(this._x=Math.asin(i(l)),.99999>Math.abs(l)?(this._y=Math.atan2(-u,n),this._z=Math.atan2(-s,h)):(this._y=0,this._z=Math.atan2(a,r))):"ZYX"===e?(this._y=Math.asin(-i(u)),.99999>Math.abs(u)?(this._x=Math.atan2(l,n),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,h))):"YZX"===e?(this._z=Math.asin(i(a)),.99999>Math.abs(a)?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,n))):"XZY"===e?(this._z=Math.asin(-i(s)),.99999>Math.abs(s)?(this._x=Math.atan2(l,h),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,n),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+e),this._order=e,this._updateQuaternion(),this},setFromQuaternion:function(t,e,i){function n(t){return Math.min(Math.max(t,-1),1)}var r=t.x*t.x,s=t.y*t.y,o=t.z*t.z,a=t.w*t.w;return e=e||this._order,"XYZ"===e?(this._x=Math.atan2(2*(t.x*t.w-t.y*t.z),a-r-s+o),this._y=Math.asin(n(2*(t.x*t.z+t.y*t.w))),this._z=Math.atan2(2*(t.z*t.w-t.x*t.y),a+r-s-o)):"YXZ"===e?(this._x=Math.asin(n(2*(t.x*t.w-t.y*t.z))),this._y=Math.atan2(2*(t.x*t.z+t.y*t.w),a-r-s+o),this._z=Math.atan2(2*(t.x*t.y+t.z*t.w),a-r+s-o)):"ZXY"===e?(this._x=Math.asin(n(2*(t.x*t.w+t.y*t.z))),this._y=Math.atan2(2*(t.y*t.w-t.z*t.x),a-r-s+o),this._z=Math.atan2(2*(t.z*t.w-t.x*t.y),a-r+s-o)):"ZYX"===e?(this._x=Math.atan2(2*(t.x*t.w+t.z*t.y),a-r-s+o),this._y=Math.asin(n(2*(t.y*t.w-t.x*t.z))),this._z=Math.atan2(2*(t.x*t.y+t.z*t.w),a+r-s-o)):"YZX"===e?(this._x=Math.atan2(2*(t.x*t.w-t.z*t.y),a-r+s-o),this._y=Math.atan2(2*(t.y*t.w-t.x*t.z),a+r-s-o),this._z=Math.asin(n(2*(t.x*t.y+t.z*t.w)))):"XZY"===e?(this._x=Math.atan2(2*(t.x*t.w+t.y*t.z),a-r+s-o),this._y=Math.atan2(2*(t.x*t.z+t.y*t.w),a+r-s-o),this._z=Math.asin(n(2*(t.z*t.w-t.x*t.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+e),this._order=e,!1!==i&&this._updateQuaternion(),this},reorder:function(){var t=new i.Quaternion;return function(e){t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},clone:function(){return new i.Euler(this._x,this._y,this._z,this._order)}},i.Matrix3=function(t,e,i,n,r,s,o,a,h){this.elements=new Float32Array(9),this.set(void 0!==t?t:1,e||0,i||0,n||0,void 0!==r?r:1,s||0,o||0,a||0,void 0!==h?h:1)},i.Matrix3.prototype={constructor:i.Matrix3,set:function(t,e,i,n,r,s,o,a,h){var c=this.elements;return c[0]=t,c[3]=e,c[6]=i,c[1]=n,c[4]=r,c[7]=s,c[2]=o,c[5]=a,c[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(t){return t=t.elements,this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(t){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){var t=new i.Vector3;return function(e){for(var i=0,n=e.length;n>i;i+=3)t.x=e[i],t.y=e[i+1],t.z=e[i+2],t.applyMatrix3(this),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z;return e}}(),multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],h=t[7],t=t[8];return e*s*t-e*o*h-i*r*t+i*o*a+n*r*h-n*s*a},getInverse:function(t,e){var i=t.elements,n=this.elements;if(n[0]=i[10]*i[5]-i[6]*i[9],n[1]=-i[10]*i[1]+i[2]*i[9],n[2]=i[6]*i[1]-i[2]*i[5],n[3]=-i[10]*i[4]+i[6]*i[8],n[4]=i[10]*i[0]-i[2]*i[8],n[5]=-i[6]*i[0]+i[2]*i[4],n[6]=i[9]*i[4]-i[5]*i[8],n[7]=-i[9]*i[0]+i[1]*i[8],n[8]=i[5]*i[0]-i[1]*i[4],i=i[0]*n[0]+i[1]*n[3]+i[2]*n[6],0===i){if(e)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/i),this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.getInverse(t).transpose(),this},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]},clone:function(){var t=this.elements;return new i.Matrix3(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}},i.Matrix4=function(t,e,i,n,r,s,o,a,h,c,u,l,d,f,m,p){var y=this.elements=new Float32Array(16);y[0]=void 0!==t?t:1,y[4]=e||0,y[8]=i||0,y[12]=n||0,y[1]=r||0,y[5]=void 0!==s?s:1,y[9]=o||0,y[13]=a||0,y[2]=h||0,y[6]=c||0,y[10]=void 0!==u?u:1,y[14]=l||0,y[3]=d||0,y[7]=f||0,y[11]=m||0,y[15]=void 0!==p?p:1},i.Matrix4.prototype={constructor:i.Matrix4,set:function(t,e,i,n,r,s,o,a,h,c,u,l,d,f,m,p){var y=this.elements;return y[0]=t,y[4]=e,y[8]=i,y[12]=n,y[1]=r,y[5]=s,y[9]=o,y[13]=a,y[2]=h,y[6]=c,y[10]=u,y[14]=l,y[3]=d,y[7]=f,y[11]=m,y[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(t){return this.elements.set(t.elements),this},extractPosition:function(t){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},copyPosition:function(t){var e=this.elements;return t=t.elements,e[12]=t[12],e[13]=t[13],e[14]=t[14],this},extractRotation:function(){var t=new i.Vector3;return function(e){var i=this.elements;e=e.elements;var n=1/t.set(e[0],e[1],e[2]).length(),r=1/t.set(e[4],e[5],e[6]).length(),s=1/t.set(e[8],e[9],e[10]).length();return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[4]=e[4]*r,i[5]=e[5]*r,i[6]=e[6]*r,i[8]=e[8]*s,i[9]=e[9]*s,i[10]=e[10]*s,this}}(),makeRotationFromEuler:function(t){!1==t instanceof i.Euler&&console.error("ERROR: Matrix's .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var e=this.elements,n=t.x,r=t.y,s=t.z,o=Math.cos(n),n=Math.sin(n),a=Math.cos(r),r=Math.sin(r),h=Math.cos(s),s=Math.sin(s);if("XYZ"===t.order){t=o*h;var c=o*s,u=n*h,l=n*s;e[0]=a*h,e[4]=-a*s,e[8]=r,e[1]=c+u*r,e[5]=t-l*r,e[9]=-n*a,e[2]=l-t*r,e[6]=u+c*r,e[10]=o*a}else"YXZ"===t.order?(t=a*h,c=a*s,u=r*h,l=r*s,e[0]=t+l*n,e[4]=u*n-c,e[8]=o*r,e[1]=o*s,e[5]=o*h,e[9]=-n,e[2]=c*n-u,e[6]=l+t*n,e[10]=o*a):"ZXY"===t.order?(t=a*h,c=a*s,u=r*h,l=r*s,e[0]=t-l*n,e[4]=-o*s,e[8]=u+c*n,e[1]=c+u*n,e[5]=o*h,e[9]=l-t*n,e[2]=-o*r,e[6]=n,e[10]=o*a):"ZYX"===t.order?(t=o*h,c=o*s,u=n*h,l=n*s,e[0]=a*h,e[4]=u*r-c,e[8]=t*r+l,e[1]=a*s,e[5]=l*r+t,e[9]=c*r-u,e[2]=-r,e[6]=n*a,e[10]=o*a):"YZX"===t.order?(t=o*a,c=o*r,u=n*a,l=n*r,e[0]=a*h,e[4]=l-t*s,e[8]=u*s+c,e[1]=s,e[5]=o*h,e[9]=-n*h,e[2]=-r*h,e[6]=c*s+u,e[10]=t-l*s):"XZY"===t.order&&(t=o*a,c=o*r,u=n*a,l=n*r,e[0]=a*h,e[4]=-s,e[8]=r*h,e[1]=t*s+l,e[5]=o*h,e[9]=c*s-u,e[2]=u*s-c,e[6]=n*h,e[10]=l*s+t);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},setRotationFromQuaternion:function(t){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(t)},makeRotationFromQuaternion:function(t){var e=this.elements,i=t.x,n=t.y,r=t.z,s=t.w,o=i+i,a=n+n,h=r+r;t=i*o;var c=i*a,i=i*h,u=n*a,n=n*h,r=r*h,o=s*o,a=s*a,s=s*h;return e[0]=1-(u+r),e[4]=c-s,e[8]=i+a,e[1]=c+s,e[5]=1-(t+r),e[9]=n-o,e[2]=i-a,e[6]=n+o,e[10]=1-(t+u),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(){var t=new i.Vector3,e=new i.Vector3,n=new i.Vector3;return function(i,r,s){var o=this.elements;return n.subVectors(i,r).normalize(),0===n.length()&&(n.z=1),t.crossVectors(s,n).normalize(),0===t.length()&&(n.x+=1e-4,t.crossVectors(s,n).normalize()),e.crossVectors(n,t),o[0]=t.x,o[4]=e.x,o[8]=n.x,o[1]=t.y,o[5]=e.y,o[9]=n.y,o[2]=t.z,o[6]=e.z,o[10]=n.z,this}}(),multiply:function(t,e){return void 0!==e?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,r=this.elements,s=i[0],o=i[4],a=i[8],h=i[12],c=i[1],u=i[5],l=i[9],d=i[13],f=i[2],m=i[6],p=i[10],y=i[14],x=i[3],v=i[7],w=i[11],i=i[15],g=n[0],b=n[4],E=n[8],M=n[12],D=n[1],_=n[5],z=n[9],S=n[13],T=n[2],C=n[6],O=n[10],F=n[14],A=n[3],P=n[7],R=n[11],n=n[15];return r[0]=s*g+o*D+a*T+h*A,r[4]=s*b+o*_+a*C+h*P,r[8]=s*E+o*z+a*O+h*R,r[12]=s*M+o*S+a*F+h*n,r[1]=c*g+u*D+l*T+d*A,r[5]=c*b+u*_+l*C+d*P,r[9]=c*E+u*z+l*O+d*R,r[13]=c*M+u*S+l*F+d*n,r[2]=f*g+m*D+p*T+y*A,r[6]=f*b+m*_+p*C+y*P,r[10]=f*E+m*z+p*O+y*R,r[14]=f*M+m*S+p*F+y*n,r[3]=x*g+v*D+w*T+i*A,r[7]=x*b+v*_+w*C+i*P,r[11]=x*E+v*z+w*O+i*R,r[15]=x*M+v*S+w*F+i*n,this},multiplyToArray:function(t,e,i){var n=this.elements;return this.multiplyMatrices(t,e),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},multiplyVector3:function(t){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),t.applyProjection(this)},multiplyVector4:function(t){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){var t=new i.Vector3;return function(e){for(var i=0,n=e.length;n>i;i+=3)t.x=e[i],t.y=e[i+1],t.z=e[i+2],t.applyProjection(this),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z;return e}}(),rotateAxis:function(t){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},determinant:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],o=t[5],a=t[9],h=t[13],c=t[2],u=t[6],l=t[10],d=t[14];return t[3]*(+r*a*u-n*h*u-r*o*l+i*h*l+n*o*d-i*a*d)+t[7]*(+e*a*d-e*h*l+r*s*l-n*s*d+n*h*c-r*a*c)+t[11]*(+e*h*u-e*o*d-r*s*u+i*s*d+r*o*c-i*h*c)+t[15]*(-n*o*c-e*a*u+e*o*l+n*s*u-i*s*l+i*a*c)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},flattenToArrayOffset:function(t,e){var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t},getPosition:function(){var t=new i.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var e=this.elements;return t.set(e[12],e[13],e[14])}}(),setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var i=this.elements,n=t.elements,r=n[0],s=n[4],o=n[8],a=n[12],h=n[1],c=n[5],u=n[9],l=n[13],d=n[2],f=n[6],m=n[10],p=n[14],y=n[3],x=n[7],v=n[11],n=n[15];if(i[0]=u*p*x-l*m*x+l*f*v-c*p*v-u*f*n+c*m*n,i[4]=a*m*x-o*p*x-a*f*v+s*p*v+o*f*n-s*m*n,i[8]=o*l*x-a*u*x+a*c*v-s*l*v-o*c*n+s*u*n,i[12]=a*u*f-o*l*f-a*c*m+s*l*m+o*c*p-s*u*p,i[1]=l*m*y-u*p*y-l*d*v+h*p*v+u*d*n-h*m*n,i[5]=o*p*y-a*m*y+a*d*v-r*p*v-o*d*n+r*m*n,i[9]=a*u*y-o*l*y-a*h*v+r*l*v+o*h*n-r*u*n,i[13]=o*l*d-a*u*d+a*h*m-r*l*m-o*h*p+r*u*p,i[2]=c*p*y-l*f*y+l*d*x-h*p*x-c*d*n+h*f*n,i[6]=a*f*y-s*p*y-a*d*x+r*p*x+s*d*n-r*f*n,i[10]=s*l*y-a*c*y+a*h*x-r*l*x-s*h*n+r*c*n,i[14]=a*c*d-s*l*d-a*h*f+r*l*f+s*h*p-r*c*p,i[3]=u*f*y-c*m*y-u*d*x+h*m*x+c*d*v-h*f*v,i[7]=s*m*y-o*f*y+o*d*x-r*m*x-s*d*v+r*f*v,i[11]=o*c*y-s*u*y-o*h*x+r*u*x+s*h*v-r*c*v,i[15]=s*u*d-o*c*d+o*h*f-r*u*f-s*h*m+r*c*m,i=r*i[0]+h*i[4]+d*i[8]+y*i[12],0==i){if(e)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/i),this},translate:function(){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(t){var e=this.elements,i=t.x,n=t.y;return t=t.z,e[0]*=i,e[4]*=n,e[8]*=t,e[1]*=i,e[5]*=n,e[9]*=t,e[2]*=i,e[6]*=n,e[10]*=t,e[3]*=i,e[7]*=n,e[11]*=t,this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],Math.max(t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10])))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,o=t.y,a=t.z,h=r*s,c=r*o;return this.set(h*s+i,h*o-n*a,h*a+n*o,0,h*o+n*a,c*o+i,c*a-n*s,0,h*a-n*o,c*a+n*s,r*a*a+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},compose:function(t,e,i){return this.makeRotationFromQuaternion(e),this.scale(i),this.setPosition(t),this},decompose:function(){var t=new i.Vector3,e=new i.Matrix4;return function(i,n,r){var s=this.elements,o=t.set(s[0],s[1],s[2]).length(),a=t.set(s[4],s[5],s[6]).length(),h=t.set(s[8],s[9],s[10]).length();0>this.determinant()&&(o=-o),i.x=s[12],i.y=s[13],i.z=s[14],e.elements.set(this.elements),i=1/o;var s=1/a,c=1/h;return e.elements[0]*=i,e.elements[1]*=i,e.elements[2]*=i,e.elements[4]*=s,e.elements[5]*=s,e.elements[6]*=s,e.elements[8]*=c,e.elements[9]*=c,e.elements[10]*=c,n.setFromRotationMatrix(e),r.x=o,r.y=a,r.z=h,this}}(),makeFrustum:function(t,e,i,n,r,s){var o=this.elements;return o[0]=2*r/(e-t),o[4]=0,o[8]=(e+t)/(e-t),o[12]=0,o[1]=0,o[5]=2*r/(n-i),o[9]=(n+i)/(n-i),o[13]=0,o[2]=0,o[6]=0,o[10]=-(s+r)/(s-r),o[14]=-2*s*r/(s-r),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(t,e,n,r){t=n*Math.tan(i.Math.degToRad(.5*t));var s=-t;return this.makeFrustum(s*e,t*e,s,t,n,r)},makeOrthographic:function(t,e,i,n,r,s){var o=this.elements,a=e-t,h=i-n,c=s-r;return o[0]=2/a,o[4]=0,o[8]=0,o[12]=-((e+t)/a),o[1]=0,o[5]=2/h,o[9]=0,o[13]=-((i+n)/h),o[2]=0,o[6]=0,o[10]=-2/c,o[14]=-((s+r)/c),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]},clone:function(){var t=this.elements;return new i.Matrix4(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}},i.Object3D=function(){this.id=i.Object3DIdCount++,this.uuid=i.Math.generateUUID(),this.name="",this.parent=void 0,this.children=[],this.up=new i.Vector3(0,1,0),this.position=new i.Vector3,this._rotation=new i.Euler,this._quaternion=new i.Quaternion,this.scale=new i.Vector3(1,1,1),this._rotation._quaternion=this.quaternion,this._quaternion._euler=this.rotation,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new i.Matrix4,this.matrixWorld=new i.Matrix4,this.visible=this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.userData={}},i.Object3D.prototype={constructor:i.Object3D,get rotation(){return this._rotation},set rotation(t){this._rotation=t,this._rotation._quaternion=this._quaternion,this._quaternion._euler=this._rotation,this._rotation._updateQuaternion()},get quaternion(){return this._quaternion},set quaternion(t){this._quaternion=t,this._quaternion._euler=this._rotation,this._rotation._quaternion=this._quaternion,this._quaternion._updateEuler()},get eulerOrder(){return console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order},set eulerOrder(t){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order=t},get useQuaternion(){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(t){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new i.Quaternion;return function(e,i){return t.setFromAxisAngle(e,i),this.quaternion.multiply(t),this}}(),rotateX:function(){var t=new i.Vector3(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new i.Vector3(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new i.Vector3(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new i.Vector3;return function(e,i){return t.copy(e),t.applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(i)),this}}(),translate:function(t,e){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(e,t)},translateX:function(){var t=new i.Vector3(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new i.Vector3(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new i.Vector3(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new i.Matrix4;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new i.Matrix4;return function(e){t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(t===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(t instanceof i.Object3D){void 0!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t);for(var e=this;void 0!==e.parent;)e=e.parent;void 0!==e&&e instanceof i.Scene&&e.__addObject(t)}},remove:function(t){var e=this.children.indexOf(t);if(-1!==e){for(t.parent=void 0,t.dispatchEvent({type:"removed"}),this.children.splice(e,1),e=this;void 0!==e.parent;)e=e.parent;void 0!==e&&e instanceof i.Scene&&e.__removeObject(t)}},traverse:function(t){t(this);for(var e=0,i=this.children.length;i>e;e++)this.children[e].traverse(t)},getObjectById:function(t,e){for(var i=0,n=this.children.length;n>i;i++){var r=this.children[i];if(r.id===t||!0===e&&(r=r.getObjectById(t,e),void 0!==r))return r}},getObjectByName:function(t,e){for(var i=0,n=this.children.length;n>i;i++){var r=this.children[i];if(r.name===t||!0===e&&(r=r.getObjectByName(t,e),void 0!==r))return r}},getChildByName:function(t,e){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t,e)},getDescendants:function(t){void 0===t&&(t=[]),Array.prototype.push.apply(t,this.children);for(var e=0,i=this.children.length;i>e;e++)this.children[e].getDescendants(t);return t},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){!0===this.matrixAutoUpdate&&this.updateMatrix(),(!0===this.matrixWorldNeedsUpdate||!0===t)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=0,i=this.children.length;i>e;e++)this.children[e].updateMatrixWorld(t)},clone:function(t,e){if(void 0===t&&(t=new i.Object3D),void 0===e&&(e=!0),t.name=this.name,t.up.copy(this.up),t.position.copy(this.position),t.quaternion.copy(this.quaternion),t.scale.copy(this.scale),t.renderDepth=this.renderDepth,t.rotationAutoUpdate=this.rotationAutoUpdate,t.matrix.copy(this.matrix),t.matrixWorld.copy(this.matrixWorld),t.matrixAutoUpdate=this.matrixAutoUpdate,t.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,t.visible=this.visible,t.castShadow=this.castShadow,t.receiveShadow=this.receiveShadow,t.frustumCulled=this.frustumCulled,t.userData=JSON.parse(JSON.stringify(this.userData)),!0===e)for(var n=0;n<this.children.length;n++)t.add(this.children[n].clone());return t}},i.EventDispatcher.prototype.apply(i.Object3D.prototype),i.Object3DIdCount=0,i.Camera=function(){i.Object3D.call(this),this.matrixWorldInverse=new i.Matrix4,this.projectionMatrix=new i.Matrix4},i.Camera.prototype=Object.create(i.Object3D.prototype),i.Camera.prototype.lookAt=function(){var t=new i.Matrix4;return function(e){t.lookAt(this.position,e,this.up),this.quaternion.setFromRotationMatrix(t)}}(),i.Camera.prototype.clone=function(t){return void 0===t&&(t=new i.Camera),i.Object3D.prototype.clone.call(this,t),t.matrixWorldInverse.copy(this.matrixWorldInverse),t.projectionMatrix.copy(this.projectionMatrix),t},i.PerspectiveCamera=function(t,e,n,r){i.Camera.call(this),this.fov=void 0!==t?t:50,this.aspect=void 0!==e?e:1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},i.PerspectiveCamera.prototype=Object.create(i.Camera.prototype),i.PerspectiveCamera.prototype.setLens=function(t,e){void 0===e&&(e=24),this.fov=2*i.Math.radToDeg(Math.atan(e/(2*t))),this.updateProjectionMatrix()},i.PerspectiveCamera.prototype.setViewOffset=function(t,e,i,n,r,s){this.fullWidth=t,this.fullHeight=e,this.x=i,this.y=n,this.width=r,this.height=s,this.updateProjectionMatrix()},i.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var t=this.fullWidth/this.fullHeight,e=Math.tan(i.Math.degToRad(.5*this.fov))*this.near,n=-e,r=t*n,t=Math.abs(t*e-r),n=Math.abs(e-n);this.projectionMatrix.makeFrustum(r+this.x*t/this.fullWidth,r+(this.x+this.width)*t/this.fullWidth,e-(this.y+this.height)*n/this.fullHeight,e-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},i.PerspectiveCamera.prototype.clone=function(){var t=new i.PerspectiveCamera;return i.Camera.prototype.clone.call(this,t),t.fov=this.fov,t.aspect=this.aspect,t.near=this.near,t.far=this.far,t},i.Ray=function(t,e){this.origin=void 0!==t?t:new i.Vector3,this.direction=void 0!==e?e:new i.Vector3},i.Ray.prototype={constructor:i.Ray,set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return(e||new i.Vector3).copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var t=new i.Vector3;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){var n=e||new i.Vector3;n.subVectors(t,this.origin);var r=n.dot(this.direction);return 0>r?n.copy(this.origin):n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var t=new i.Vector3;return function(e){var i=t.subVectors(e,this.origin).dot(this.direction);return 0>i?this.origin.distanceTo(e):(t.copy(this.direction).multiplyScalar(i).add(this.origin),t.distanceTo(e))}}(),distanceSqToSegment:function(t,e,i,n){var r=t.clone().add(e).multiplyScalar(.5),s=e.clone().sub(t).normalize(),o=.5*t.distanceTo(e),a=this.origin.clone().sub(r);t=-this.direction.dot(s),e=a.dot(this.direction);var h,c,u=-a.dot(s),l=a.lengthSq(),d=Math.abs(1-t*t);return d>=0?(a=t*u-e,h=t*e-u,c=o*d,a>=0?h>=-c?c>=h?(o=1/d,a*=o,h*=o,t=a*(a+t*h+2*e)+h*(t*a+h+2*u)+l):(h=o,a=Math.max(0,-(t*h+e)),t=-a*a+h*(h+2*u)+l):(h=-o,a=Math.max(0,-(t*h+e)),t=-a*a+h*(h+2*u)+l):-c>=h?(a=Math.max(0,-(-t*o+e)),h=a>0?-o:Math.min(Math.max(-o,-u),o),t=-a*a+h*(h+2*u)+l):c>=h?(a=0,h=Math.min(Math.max(-o,-u),o),t=h*(h+2*u)+l):(a=Math.max(0,-(t*o+e)),h=a>0?o:Math.min(Math.max(-o,-u),o),t=-a*a+h*(h+2*u)+l)):(h=t>0?-o:o,a=Math.max(0,-(t*h+e)),t=-a*a+h*(h+2*u)+l),i&&i.copy(this.direction.clone().multiplyScalar(a).add(this.origin)),n&&n.copy(s.clone().multiplyScalar(h).add(r)),t},isIntersectionSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},isIntersectionPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||0>t.normal.dot(this.direction)*e?!0:!1},distanceToPlane:function(t){var e=t.normal.dot(this.direction);return 0==e?0==t.distanceToPoint(this.origin)?0:null:(t=-(this.origin.dot(t.normal)+t.constant)/e,t>=0?t:null)},intersectPlane:function(t,e){var i=this.distanceToPlane(t);return null===i?null:this.at(i,e)},isIntersectionBox:function(){var t=new i.Vector3;return function(e){return null!==this.intersectBox(e,t)}}(),intersectBox:function(t,e){var i,n,r,s,o;n=1/this.direction.x,s=1/this.direction.y,o=1/this.direction.z;var a=this.origin;return n>=0?(i=(t.min.x-a.x)*n,n*=t.max.x-a.x):(i=(t.max.x-a.x)*n,n*=t.min.x-a.x),s>=0?(r=(t.min.y-a.y)*s,s*=t.max.y-a.y):(r=(t.max.y-a.y)*s,s*=t.min.y-a.y),i>s||r>n?null:((r>i||i!==i)&&(i=r),(n>s||n!==n)&&(n=s),o>=0?(r=(t.min.z-a.z)*o,o*=t.max.z-a.z):(r=(t.max.z-a.z)*o,o*=t.min.z-a.z),i>o||r>n?null:((r>i||i!==i)&&(i=r),(n>o||n!==n)&&(n=o),0>n?null:this.at(i>=0?i:n,e)))},intersectTriangle:function(){var t=new i.Vector3,e=new i.Vector3,n=new i.Vector3,r=new i.Vector3;return function(i,s,o,a,h){if(e.subVectors(s,i),n.subVectors(o,i),r.crossVectors(e,n),s=this.direction.dot(r),s>0){if(a)return null;a=1}else{if(!(0>s))return null;a=-1,s=-s}return t.subVectors(this.origin,i),i=a*this.direction.dot(n.crossVectors(t,n)),0>i?null:(o=a*this.direction.dot(e.cross(t)),0>o||i+o>s?null:(i=-a*t.dot(r),0>i?null:this.at(i/s,h)))}}(),applyMatrix4:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)},clone:function(){return(new i.Ray).copy(this)}},i.Plane=function(t,e){this.normal=void 0!==t?t:new i.Vector3(1,0,0),this.constant=void 0!==e?e:0},i.Plane.prototype={constructor:i.Plane,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new i.Vector3,e=new i.Vector3;return function(i,n,r){return n=t.subVectors(r,n).cross(e.subVectors(i,n)).normalize(),this.setFromNormalAndCoplanarPoint(n,i),this}}(),copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(t,e){var n=this.distanceToPoint(t);return(e||new i.Vector3).copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(t){var e=this.distanceToPoint(t.start);return t=this.distanceToPoint(t.end),0>e&&t>0||0>t&&e>0},intersectLine:function(){var t=new i.Vector3;return function(e,n){var r=n||new i.Vector3,s=e.delta(t),o=this.normal.dot(s);return 0!=o?(o=-(e.start.dot(this.normal)+this.constant)/o,0>o||o>1?void 0:r.copy(s).multiplyScalar(o).add(e.start)):0==this.distanceToPoint(e.start)?r.copy(e.start):void 0}}(),coplanarPoint:function(t){return(t||new i.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new i.Vector3,e=new i.Vector3,n=new i.Matrix3;return function(i,r){var s=r||n.getNormalMatrix(i),s=t.copy(this.normal).applyMatrix3(s),o=this.coplanarPoint(e);return o.applyMatrix4(i),this.setFromNormalAndCoplanarPoint(s,o),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant==this.constant},clone:function(){return(new i.Plane).copy(this)}},i.CSS3DObject=function(t){i.Object3D.call(this),this.element=t,this.done=!1,this.element.style.position="absolute",this.addEventListener("removed",function(t){if(null!==this.element.parentNode){this.element.parentNode.removeChild(this.element);for(var e=0,i=this.children.length;i>e;e++)this.children[e].dispatchEvent(t)}})},i.CSS3DObject.prototype=Object.create(i.Object3D.prototype),i.CSS3DSprite=function(t){i.CSS3DObject.call(this,t)},i.CSS3DSprite.prototype=Object.create(i.CSS3DObject.prototype),i.CSS3DRenderer=function(){var t,e,n,r,s=new i.Matrix4,o=document.createElement("div");o.style.overflow="hidden",o.style.WebkitTransformStyle="preserve-3d",o.style.MozTransformStyle="preserve-3d",o.style.oTransformStyle="preserve-3d",o.style.transformStyle="preserve-3d",this.domElement=o;var a=document.createElement("div");a.style.WebkitTransformStyle="preserve-3d",a.style.MozTransformStyle="preserve-3d",a.style.oTransformStyle="preserve-3d",a.style.transformStyle="preserve-3d",o.appendChild(a),this.setClearColor=function(){},this.setSize=function(i,s){t=i,e=s,n=t/2,r=e/2,o.style.width=i+"px",o.style.height=s+"px",a.style.width=i+"px",a.style.height=s+"px"};var h=function(t){return 1e-6>Math.abs(t)?0:t},c=function(){var t=new i.Vector3,e=new i.Vector3,n=new i.Euler,r=new i.Quaternion;return n._quaternion=r,r._euler=n,function(i){return i.decompose(t,r,e),"translate3d(-50%,-50%,0) translate3d("+h(t.x)+"px, "+h(t.y)+"px, "+h(t.z)+"px) rotateX("+h(n.x)+"rad) rotateY("+h(n.y)+"rad) rotateZ("+h(n.z)+"rad) scale3d("+h(e.x)+", "+h(-e.y)+", "+h(e.z)+")"}}(),u=function(t,e){if(t instanceof i.CSS3DObject){var n;t instanceof i.CSS3DSprite?(s.copy(e.matrixWorldInverse),s.transpose(),s.copyPosition(t.matrixWorld),s.scale(t.scale),s.elements[3]=0,s.elements[7]=0,s.elements[11]=0,s.elements[15]=1,n=c(s)):n=c(t.matrixWorld);
var r=t.element;r.style.WebkitTransformStyle="preserve-3d",r.style.MozTransformStyle="preserve-3d",r.style.oTransformStyle="preserve-3d",r.style.transformStyle="preserve-3d",r.style.WebkitTransform=n,r.style.MozTransform=n,r.style.oTransform=n,r.style.transform=n,r.parentNode!==a&&a.appendChild(r)}for(n=0,r=t.children.length;r>n;n++)u(t.children[n],e)};this.render=function(t,s){var c=.5/Math.tan(i.Math.degToRad(.5*s.fov))*e;o.style.WebkitPerspective=c+"px",o.style.MozPerspective=c+"px",o.style.oPerspective=c+"px",o.style.perspective=c+"px",t.updateMatrixWorld(),void 0===s.parent&&s.updateMatrixWorld(),s.matrixWorldInverse.getInverse(s.matrixWorld);var l,c="translate3d(0,0,"+c+"px)";l=s.matrixWorldInverse.elements,l="matrix3d("+h(l[0])+","+h(-l[1])+","+h(l[2])+","+h(l[3])+","+h(l[4])+","+h(-l[5])+","+h(l[6])+","+h(l[7])+","+h(l[8])+","+h(-l[9])+","+h(l[10])+","+h(l[11])+","+h(l[12])+","+h(-l[13])+","+h(l[14])+","+h(l[15])+")",c=c+l+" translate3d("+n+"px,"+r+"px, 0)",a.style.WebkitTransform=c,a.style.MozTransform=c,a.style.oTransform=c,a.style.transform=c,u(t,s)}};var n={isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},cascade:function(){var t,e=Array.prototype.slice.call(arguments);for(t=0;t<e.length;t++)if(void 0!==e[t])return e[t];return!1},hexToRgb:function(t){return t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,n){return e+e+i+i+n+n}),(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t))?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}};t.extend(Number.prototype,{absolute:function(){return Math.abs(this)},add:function(){var t=this;return Array.prototype.slice.call(arguments).forEach(function(e){t+=e}),t},arcCosine:function(){return Math.acos(this)},arcSine:function(){return Math.asin(this)},arcTangent:function(){return Math.atan(this)},constrain:function(t,e){var i,n,r=this;return e=e||0,i=Math.max(t,e),n=Math.min(t,e),r=Math.min(r,i),r=Math.max(r,n)},cosine:function(){return Math.cos(this)},degreesToDirection:function(){var t="N NNE NE NEE E SEE SE SSE S SSW SW SWW W NWW NW NNW N".split(" ");return t[this.scale(0,360,0,t.length-1).round()]},degreesToRadians:function(){return this*Math.PI/180},divide:function(){var t=this;return Array.prototype.slice.call(arguments).forEach(function(e){t/=e}),t},isBetween:function(t,e){var i=Math.min(t,e),n=Math.max(t,e);return this>=i&&n>=this},lerp:function(t,e){return t+(e-t)*this},log:function(t){return Math.log(this)/(void 0===t?1:Math.log(t))},log10:function(){return Math.log(this)/Math.LN10},maximum:function(t){return Math.max(this,t)},minimum:function(t){return Math.min(this,t)},modulo:function(t){return(this%t+t)%t},multiply:function(){var t=this;return Array.prototype.slice.call(arguments).forEach(function(e){t*=e}),t},normalize:function(t,e){return t==e?1:(this-t)/(e-t)},raiseTo:function(t){return Math.pow(this,t)},radiansToDegrees:function(){return 180*this/Math.PI},rand:function(t){var e;return void 0!==t?(e=Math.min(this,t),t=Math.max(this,t),e+Math.floor(Math.random()*(t-e))):Math.floor(Math.random()*this)},random:function(t){var e;return void 0!==t?(e=Math.min(this,t),t=Math.max(this,t),e+Math.random()*(t-e)):Math.random()*this},remainder:function(t){return this%t},round:function(t){var e;return t=t||0,e=this*Math.pow(10,t),e=Math.round(e),e/=Math.pow(10,t)},roundDown:function(){return Math.floor(this)},roundUp:function(){return Math.ceil(this)},scale:function(t,e,i,n){return t=this.normalize(t,e),i==n?n:i+t*(n-i)},sine:function(){return Math.sin(this)},subtract:function(){var t=this;return Array.prototype.slice.call(arguments).forEach(function(e){t-=e}),t},tangent:function(){return Math.tan(this)},toArray:function(){return[this.valueOf()]},toNumber:function(){return this.valueOf()},toPaddedString:function(t){return("0000000000000"+String(this)).slice(-t)},toSignedString:function(){var t=""+this;return this>=0&&(t="+"+t),t},toString:function(){return""+this}}),t.extend(String.prototype,{capitalize:function(){return this.charAt(0).toUpperCase()+this.slice(1)},invert:function(){var t,e="";for(t=0;t<this.length;t++)e=this.charAt(t)===this.charAt(t).toUpperCase()?e+this.charAt(t).toLowerCase():e+this.charAt(t).toUpperCase();return e},justifyCenter:function(t){var e=Math.round(this.length/2),i=this.length-e,n=Math.round(t/2),e=n-e;if(t=t-n-i,i=this,e>0)for(;e--;)i=" "+i;else 0>e&&(i=i.substr(-1*e));if(t>0)for(;t--;)i+=" ";else 0>t&&(i=i.substr(0,i.length+t));return i},justifyLeft:function(t){for(var e=this;e.length<t;)e+=" ";return e},justifyRight:function(t){for(var e=this;e.length<t;)e=" "+e;return e},multiply:function(t){var e,i="";for(t=n.cascade(t,2),e=0;t>e;e++)i+=this;return i},reverse:function(){var t,e="";for(t=0;t<this.length;t++)e=this[t]+e;return e},size:function(){return this.length},toEntities:function(){var t,e="";for(t=0;t<this.length;t++)e+="&#"+this.charCodeAt(t)+";";return e},toCamelCase:function(){var t,e=this.split(/\W+|_+/),i=e[0];for(t=1;t<e.length;t++)i+=e[t].capitalize();return i},directionToDegrees:function(){var t="N NNE NE NEE E SEE SE SSE S SSW SW SWW W NWW NW NNW N".split(" "),e=t.indexOf(this.toUpperCase());return e>=0?e.scale(0,t.length-1,0,360):Number.NaN},toArray:function(){return[this]},toNumber:function(){return parseFloat(this)},toString:function(){return this},toUnderscoreCase:function(){var t=this.replace(/[A-Z]+/g,function(t){return"_"+t});return"_"===t.charAt(0)&&(t=t.substr(1)),t.toLowerCase()},toUnicode:function(){var t,e,i="";for(t=0;t<this.length;t++){for(e=this.charCodeAt(t).toString(16).toUpperCase();4>e.length;)e="0"+e;i+="\\u"+e}return i}}),t.extend(Array.prototype,{distanceTo:function(t){var e,i=0;if(0<arguments.length&&(t=Array.prototype.slice.call(arguments)),this.length===t.length){for(e=0;e<this.length;e++)i+=Math.pow(t[e]-this[e],2);return Math.pow(i,.5)}return null},first:function(){return this[0]},last:function(){return this[this.length-1]},maximum:function(){return Math.max.apply(null,this)},middle:function(){return this[Math.round((this.length-1)/2)]},minimum:function(){return Math.min.apply(null,this)},rand:function(){return this[Math.floor(Math.random()*this.length)]},random:function(){return this[Math.floor(Math.random()*this.length)]},shuffle:function(){var t,e,i,n=this.length;if(0==n)return!1;for(;--n;)t=Math.floor(Math.random()*(n+1)),e=this[n],i=this[t],this[n]=i,this[t]=e;return this},toArray:function(){return this},toHtml:function(){var t,e="<ul>";for(t=0;t<this.length;t++)e=this[t]instanceof Array?e+this[t].toHtml():e+("<li>"+this[t]+"</li>");return e+"</ul>"},toText:function(t){var e,i,r;for(t=n.cascade(t,0),i="\n"+"	".multiply(t),r="",e=0;e<this.length;e++)r=this[e]instanceof Array?r+(i+this[e].toText(t+1)):r+(i+this[e]);return r}}),t.Color=function(t,e,i,n,r){this.name=t,this.initial=e,this.hex=i,this.styleF=n,this.styleB=r};var r,s,o,a,h,c;r=t.WHITE=new t.Color("white","W","#FFF","font-weight: bold; color: #888","background-color: #F3F3F3; color: rgba( 0, 0, 0, 0.5 )"),s=t.ORANGE=new t.Color("orange","O","#F60","font-weight: bold; color: #F60","background-color: #F60; color: rgba( 255, 255, 255, 0.9 )"),o=t.BLUE=new t.Color("blue","B","#00D","font-weight: bold; color: #00D","background-color: #00D; color: rgba( 255, 255, 255, 0.9 )"),a=t.RED=new t.Color("red","R","#F00","font-weight: bold; color: #F00","background-color: #F00; color: rgba( 255, 255, 255, 0.9 )"),h=t.GREEN=new t.Color("green","G","#0A0","font-weight: bold; color: #0A0","background-color: #0A0; color: rgba( 255, 255, 255, 0.9 )"),c=t.YELLOW=new t.Color("yellow","Y","#FE0","font-weight: bold; color: #ED0","background-color: #FE0; color: rgba( 0, 0, 0, 0.5 )"),t.COLORLESS=new t.Color("NA","X","#DDD","color: #EEE","color: #DDD"),t.Direction=function(t,e,i){this.id=t,this.name=e.toLowerCase(),this.normal=i,this.initial=e.substr(0,1).toUpperCase(),this.neighbors=[],this.opposite=null},t.Direction.prototype.setRelationships=function(t,e,i,n,r){this.neighbors=[t,e,i,n],this.opposite=r},t.Direction.getNameById=function(t){return"front up right down left back".split(" ")[t]},t.Direction.getIdByName=function(t){return{front:0,up:1,right:2,down:3,left:4,back:5}[t]},t.Direction.getDirectionById=function(e){return[t.Direction.FRONT,t.Direction.UP,t.Direction.RIGHT,t.Direction.DOWN,t.Direction.LEFT,t.Direction.BACK][e]},t.Direction.getDirectionByInitial=function(e){return{F:t.Direction.FRONT,U:t.Direction.UP,R:t.Direction.RIGHT,D:t.Direction.DOWN,L:t.Direction.LEFT,B:t.Direction.BACK}[e.toUpperCase()]},t.Direction.getDirectionByName=function(e){return{front:t.Direction.FRONT,up:t.Direction.UP,right:t.Direction.RIGHT,down:t.Direction.DOWN,left:t.Direction.LEFT,back:t.Direction.BACK}[e.toLowerCase()]},t.Direction.getDirectionByNormal=function(){var e=new i.Vector3;return function(i){return e.x=Math.round(i.x),e.y=Math.round(i.y),e.z=Math.round(i.z),e.equals(t.Direction.FRONT.normal)?t.Direction.FRONT:e.equals(t.Direction.BACK.normal)?t.Direction.BACK:e.equals(t.Direction.UP.normal)?t.Direction.UP:e.equals(t.Direction.DOWN.normal)?t.Direction.DOWN:e.equals(t.Direction.LEFT.normal)?t.Direction.LEFT:e.equals(t.Direction.RIGHT.normal)?t.Direction.RIGHT:null}}(),t.Direction.prototype.getRotation=function(t,e,i){if(void 0===e&&(e=this.neighbors[0]),e===this||e===this.opposite)return null;i=void 0===i?1:i.modulo(4);for(var n=0;5>n&&this.neighbors[n]!==e;n++);return this.neighbors[n.add(i*t).modulo(4)]},t.Direction.prototype.getClockwise=function(t,e){return this.getRotation(1,t,e)},t.Direction.prototype.getAnticlockwise=function(t,e){return this.getRotation(-1,t,e)},t.Direction.prototype.getDirection=function(t,e){return this.getRotation(1,e,t.id-1)},t.Direction.prototype.getUp=function(e){return this.getDirection(t.Direction.UP,e)},t.Direction.prototype.getRight=function(e){return this.getDirection(t.Direction.RIGHT,e)},t.Direction.prototype.getDown=function(e){return this.getDirection(t.Direction.DOWN,e)},t.Direction.prototype.getLeft=function(e){return this.getDirection(t.Direction.LEFT,e)},t.Direction.prototype.getOpposite=function(){return this.opposite},t.Direction.FRONT=new t.Direction(0,"front",new i.Vector3(0,0,1)),t.Direction.UP=new t.Direction(1,"up",new i.Vector3(0,1,0)),t.Direction.RIGHT=new t.Direction(2,"right",new i.Vector3(1,0,0)),t.Direction.DOWN=new t.Direction(3,"down",new i.Vector3(0,-1,0)),t.Direction.LEFT=new t.Direction(4,"left",new i.Vector3(-1,0,0)),t.Direction.BACK=new t.Direction(5,"back",new i.Vector3(0,0,-1)),t.Direction.FRONT.setRelationships(t.Direction.UP,t.Direction.RIGHT,t.Direction.DOWN,t.Direction.LEFT,t.Direction.BACK),t.Direction.UP.setRelationships(t.Direction.BACK,t.Direction.RIGHT,t.Direction.FRONT,t.Direction.LEFT,t.Direction.DOWN),t.Direction.RIGHT.setRelationships(t.Direction.UP,t.Direction.BACK,t.Direction.DOWN,t.Direction.FRONT,t.Direction.LEFT),t.Direction.DOWN.setRelationships(t.Direction.FRONT,t.Direction.RIGHT,t.Direction.BACK,t.Direction.LEFT,t.Direction.UP),t.Direction.LEFT.setRelationships(t.Direction.UP,t.Direction.FRONT,t.Direction.DOWN,t.Direction.BACK,t.Direction.RIGHT),t.Direction.BACK.setRelationships(t.Direction.UP,t.Direction.LEFT,t.Direction.DOWN,t.Direction.RIGHT,t.Direction.FRONT),t.Queue=function(t){void 0!==t&&t instanceof Function&&(this.validate=t),this.history=[],this.useHistory=!0,this.future=[],this.isReady=!0,this.isLooping=!1},t.Queue.prototype.add=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this.validate&&this.validate instanceof Function&&(t=this.validate(t)),t instanceof Array&&t.forEach(function(t){this.future.push(t)}.bind(this)),this.future},t.Queue.prototype.remove=function(){var t=Array.prototype.slice.call(arguments);return t instanceof Array&&t.forEach(function(t){this.future=this.future.filter(function(e){return e!=t})}.bind(this)),this.future},t.Queue.prototype.purge=function(){var t=Array.prototype.slice.call(arguments);return t instanceof Array&&t.forEach(function(t){this.history=this.history.filter(function(e){return e!=t})}.bind(this)),this.history},t.Queue.prototype.empty=function(t){this.future=[],t&&(this.history=[])},t.Queue.prototype.do=function(){if(this.future.length){var t=this.future.shift();return this.useHistory&&this.history.push(t),t}this.isLooping&&(this.future=this.history.slice(),this.history=[])},t.Queue.prototype.undo=function(){if(this.history.length){var t=this.history.pop();return this.future.unshift(t),t}},t.Queue.prototype.redo=function(){return this.do()},t.Twist=function(t,e){t&&this.set(t,e)},t.Twist.prototype.set=function(e,i){var n={X:"Cube on X",L:"Left face",M:"Middle slice",R:"Right face",Y:"Cube on Y",U:"Up face",E:"Equator slice",D:"Down face",Z:"Cube on Z",F:"Front face",S:"Standing slice",B:"Back face"}[e.toUpperCase()];if(void 0===n)return!1;void 0!=i&&0>i&&(e=e.invert(),i=i.absolute());var r=0,s="unwise";e===e.toUpperCase()?(r=1,s="clockwise"):e===e.toLowerCase()&&(r=-1,s="anticlockwise"),this.command=e,this.group=n,this.degrees=i,this.vector=r,this.wise=s,this.isShuffle=!1,this.getInverse=function(){return new t.Twist(e.invert(),i)}},t.Twist.prototype.equals=function(t){return this.command===t.command&&this.degrees===t.degrees},t.Twist.prototype.copy=function(t){return this.command=t.command,this.group=t.group,this.degrees=t.degrees,this.vector=t.vector,this.wise=t.wise,this.isShuffle=t.isShuffle,this},t.Twist.validate=function(){var e,i,r,s,o,a,h=Array.prototype.slice.call(arguments);for(i=0;i<h.length;i++)if(e=h[i],r=i+1<h.length?h[i+1]:void 0,!(e instanceof t.Twist))if("string"==typeof e){if(1===e.length)h[i]="number"==typeof r?new t.Twist(e,r):new t.Twist(e);else if(1<e.length){for(r=/(-?\d+|[XLMRYUEDZFSB])/gi,e=e.match(r),o=0;o<e.length;o++)s=e[o],n.isNumeric(s)?e[o]=+s:(r=e.slice(0,o),a=e.slice(o+1),s=s.split(""),e=r.concat(s,a));r=h.slice(0,i),a=h.slice(i+1),h=r.concat(e,a),i--}}else e instanceof t.Direction?h[i]=e.initial:e instanceof Array?(r=h.slice(0,i),a=h.slice(i+1),h=r.concat(e,a)):h.splice(i,1),i--;return h},t.Cubelet=function(e,n,o){i.Object3D.call(this),this.cube=e,this.id=n||0,this.setAddress(this.id),this.size=e.cubeletSize||140,e=this.addressX*(this.size+.1),n=this.addressY*(this.size+.1);var a=this.addressZ*(this.size+.1);for(this.position.set(e,n,a),this.matrixSlice=(new i.Matrix4).makeTranslation(e,n,a),this.updateMatrix(),this.cube.object3D.add(this),e=0,void 0===o&&(o=[r,s,,,h]),this.faces=[],n=0;6>n;n++)a=o[n]||t.COLORLESS,this.faces[n]={},this.faces[n].id=n,this.faces[n].color=a,this.faces[n].normal=t.Direction.getNameById(n),this.faces[n].isIntrovert=a===t.COLORLESS,a!==t.COLORLESS&&e++;this.type=["core","center","edge","corner"][e],this.front=this.faces[0],this.up=this.faces[1],this.right=this.faces[2],this.down=this.faces[3],this.left=this.faces[4],this.back=this.faces[5],this.colors=(this.faces[0].color?this.faces[0].color.initial:"-")+(this.faces[1].color?this.faces[1].color.initial:"-")+(this.faces[2].color?this.faces[2].color.initial:"-")+(this.faces[3].color?this.faces[3].color.initial:"-")+(this.faces[4].color?this.faces[4].color.initial:"-")+(this.faces[5].color?this.faces[5].color.initial:"-"),this.isStickerCubelet=this.front.color&&"white"===this.front.color.name&&"center"===this.type,this.isTweening=!0,this.isTweening=this.isEngagedZ=this.isEngagedY=this.isEngagedX=!1,this.opacity=1,this.radius=0},t.Cubelet.prototype=Object.create(i.Object3D.prototype),t.extend(t.Cubelet.prototype,{setAddress:function(t){this.address=t||0,this.addressX=t.modulo(3).subtract(1),this.addressY=-1*t.modulo(9).divide(3).roundDown().subtract(1),this.addressZ=-1*t.divide(9).roundDown().subtract(1)},hasColor:function(t){var e,i,r=n.hexToRgb(t.hex);for(t=0;6>t;t++)if(i=n.hexToRgb(this.faces[t].color.hex),i.r===r.r&&i.g===r.g&&i.b===r.b){e=t;break}return void 0!==e?"front up right down left back".split(" ")[e]:!1},hasColors:function(){var t=this,e=!0;return Array.prototype.slice.call(arguments).forEach(function(i){e=e&&!!t.hasColor(i)}),e},getRadius:function(){return this.radius},setRadius:function(t,i){if(!1===this.isTweening&&(t=t||0,void 0===this.radius&&(this.radius=0),this.radius!==t)){this.isTweening=!0;var n=(this.radius-t).absolute(),r={radius:this.radius};new e.Tween(r).to({radius:t},n).easing(e.Easing.Quartic.Out).onUpdate(function(){this.position.set(this.addressX.multiply(this.size+r.radius)+.2,this.addressY.multiply(this.size+r.radius)+.2,this.addressZ.multiply(this.size+r.radius)+.2),this.updateMatrix(),this.matrixSlice.copy(this.matrix),this.radius=r.radius}.bind(this)).onComplete(function(){this.isTweening=!1,this.position.set(this.addressX.multiply(this.size+r.radius)+.2,this.addressY.multiply(this.size+r.radius)+.2,this.addressZ.multiply(this.size+r.radius)+.2),this.updateMatrix(),this.matrixSlice.copy(this.matrix),this.radius=r.radius,i instanceof Function&&i()}.bind(this)).start(this.cube.time)}}}),t.Group=function(){this.cubelets=[],this.add(Array.prototype.slice.call(arguments))},t.extend(t.Group.prototype,i.EventDispatcher.prototype),t.extend(t.Group.prototype,{add:function(){var e=this;return Array.prototype.slice.call(arguments).forEach(function(i){i instanceof t.Group&&(i=i.cubelets),i instanceof Array?e.add.apply(e,i):e.cubelets.push(i)}),this},remove:function(e){if(e instanceof t.Group&&(e=e.cubelets),e instanceof Array){var i=this;e.forEach(function(t){i.remove(t)})}for(var n=this.cubelets.length;0<n--;)this.cubelets[n]===e&&this.cubelets.splice(n,1);return this},isFlagged:function(t){var e=0;return this.cubelets.forEach(function(i){e+=i[t]?1:0}),e},isTweening:function(){return this.isFlagged("isTweening")},isEngagedX:function(){return this.isFlagged("isEngagedX")},isEngagedY:function(){return this.isFlagged("isEngagedY")},isEngagedZ:function(){return this.isFlagged("isEngagedZ")},isEngaged:function(){return this.isEngagedX()+this.isEngagedY()+this.isEngagedZ()},hasProperty:function(e,i){var n=new t.Group;return this.cubelets.forEach(function(t){t[e]===i&&n.add(t)}),n},hasId:function(t){return this.hasProperty("id",t)},hasAddress:function(t){return this.hasProperty("address",t)},hasType:function(t){return this.hasProperty("type",t)},hasColor:function(e){var i=new t.Group;return this.cubelets.forEach(function(t){t.hasColor(e)&&i.add(t)}),i},hasColors:function(){var e=new t.Group,i=Array.prototype.slice.call(arguments);return this.cubelets.forEach(function(t){t.hasColors.apply(t,i)&&e.add(t)}),e},isSolved:function(e){if(e){var i={},n=0;return e instanceof t.Direction&&(e=e.name),this.cubelets.forEach(function(t){t=t[e].color.name,void 0===i[t]?(i[t]=1,n++):i[t]++}),1===n?!0:!1}return console.warn("A face [String or ERNO.Controls] argument must be specified when using ERNO.Group.isSolved()."),!1},show:function(){return this.cubelets.forEach(function(t){t.show()}),this},hide:function(){return this.cubelets.forEach(function(t){t.hide()}),this},showPlastics:function(){return this.cubelets.forEach(function(t){t.showPlastics()}),this},hidePlastics:function(){return this.cubelets.forEach(function(t){t.hidePlastics()}),this},showExtroverts:function(){return this.cubelets.forEach(function(t){t.showExtroverts()}),this},hideExtroverts:function(){return this.cubelets.forEach(function(t){t.hideExtroverts()}),this},showIntroverts:function(t,e){return this.cubelets.forEach(function(i){i.showIntroverts(t,e)}),this},hideIntroverts:function(t,e){return this.cubelets.forEach(function(i){i.hideIntroverts(t,e)}),this},showStickers:function(){return this.cubelets.forEach(function(t){t.showStickers()}),this},hideStickers:function(){return this.cubelets.forEach(function(t){t.hideStickers()}),this},showWireframes:function(){return this.cubelets.forEach(function(t){t.showWireframes()}),this},hideWireframes:function(){return this.cubelets.forEach(function(t){t.hideWireframes()}),this},showIds:function(){return this.cubelets.forEach(function(t){t.showIds()}),this},hideIds:function(){return this.cubelets.forEach(function(t){t.hideIds()}),this},showTexts:function(){return this.cubelets.forEach(function(t){t.showTexts()}),this},hideTexts:function(){return this.cubelets.forEach(function(t){t.hideTexts()}),this},getOpacity:function(){var t=0;return this.cubelets.forEach(function(e){t+=e.getOpacity()}),t/this.cubelets.length},setOpacity:function(t,e){return this.cubelets.forEach(function(i){i.setOpacity(t,e)}),this},getRadius:function(){var t=0;return this.cubelets.forEach(function(e){t+=e.getRadius()}),t/this.cubelets.length},setRadius:function(t,e){return this.cubelets.forEach(function(i){i.setRadius(t,e)}),this}}),t.Slice=function(e,n){this.axis=new i.Vector3,this.invertedAxis=new i.Vector3,this.matrix=new i.Matrix4,this.axis.rotation=0,this.indices=e,this.neighbour=null,this.ableToHideInternalFaces=!0,this.cube=n,this.getCubelet=function(t){return n.cubelets[e[t]]},this.rotateGroupMappingOnAxis=function(){var r,s=new i.Vector3,o=new i.Vector3(1,1,1),a=new i.Vector3,h=new i.Vector3,c=new i.Matrix4;return function(i){i=Math.round(i/(.25*Math.PI))*Math.PI*.25,s.copy(o),s.sub(this.axis);var u=n.cubelets.slice();c.makeRotationAxis(this.axis,-1*i);for(var l,d=e.length;0<d--;)l=n.cubelets[e[d]],a.set(l.addressX,l.addressY,l.addressZ),h.copy(a),a.multiply(s).applyMatrix4(c),a.x=Math.round(a.x),a.y=Math.round(a.y),a.z=Math.round(a.z),a.add(h.multiply(this.axis)),a.add(o),a.y=2-a.y,a.z=2-a.z,n.cubelets[l.address]=u[9*a.z+3*a.y+a.x];for(d=0;d<n.cubelets.length;d++)n.cubelets[d].setAddress(d);c.makeRotationAxis(this.axis,i),this.cubelets.forEach(function(e){r=[],e.faces.forEach(function(e){a.copy(t.Direction.getDirectionByName(e.normal).normal),a.applyMatrix4(c),r[t.Direction.getDirectionByNormal(a).id]=e,e.normal=t.Direction.getDirectionByNormal(a).name}),e.faces=r.slice(),e.front=e.faces[0],e.up=e.faces[1],e.right=e.faces[2],e.down=e.faces[3],e.left=e.faces[4],e.back=e.faces[5]})}}(),this.map()},t.Slice.prototype=Object.create(t.Group.prototype),t.extend(t.Slice.prototype,{get origin(){return this.cube.cubelets[this.indices[4]]},get north(){return this.cube.cubelets[this.indices[1]]},get northEast(){return this.cube.cubelets[this.indices[2]]},get east(){return this.cube.cubelets[this.indices[5]]},get southEast(){return this.cube.cubelets[this.indices[8]]},get south(){return this.cube.cubelets[this.indices[7]]},get southWest(){return this.cube.cubelets[this.indices[6]]},get west(){return this.cube.cubelets[this.indices[3]]},get northWest(){return this.cube.cubelets[this.indices[0]]},get cubelets(){for(var t=[],e=this.indices.length;0<e--;)t.push(this.getCubelet(e));return t},map:function(){for(var e=0;6>e;e++)if(this.origin.faces[e].color&&this.origin.faces[e].color!==t.COLORLESS){this.color=this.origin.faces[e].color,this.face=t.Direction.getNameById(e);break}if(void 0===this.axis||0===this.axis.lengthSq()){var e=this.northEast.position.clone(),n=this.southWest.position.clone(),r=this.northWest.position.clone();this.axis=(new i.Vector3).crossVectors(n.sub(e),r.sub(e)).normalize(),this.axis.rotation=0}return this.up=new t.Group(this.northWest,this.north,this.northEast),this.equator=new t.Group(this.west,this.origin,this.east),this.down=new t.Group(this.southWest,this.south,this.southEast),this.left=new t.Group(this.northWest,this.west,this.southWest),this.middle=new t.Group(this.north,this.origin,this.south),this.right=new t.Group(this.northEast,this.east,this.southEast),(e=this.hasType("center"))&&1===e.cubelets.length?(this.center=this.hasType("center"),this.corners=new t.Group(this.hasType("corner")),this.cross=new t.Group(this.center,this.hasType("edge")),this.ex=new t.Group(this.center,this.hasType("corner"))):this.centers=new t.Group(this.hasType("center")),this.edges=new t.Group(this.hasType("edge")),this.ring=new t.Group(this.northWest,this.north,this.northEast,this.west,this.east,this.southWest,this.south,this.southEast),this.dexter=new t.Group(this.northWest,this.origin,this.southEast),this.sinister=new t.Group(this.northEast,this.origin,this.southWest),this},set rotation(t){if(this.ableToHideInternalFaces&&0!==this.cube.isFlagged("showingIntroverts")&&this.cube.hideInvisibleFaces){var e=0!==t%(.5*Math.PI);this.invertedAxis.copy(this.axis).negate(),e?this.neighbour?(this.showIntroverts(this.axis,!0),this.neighbour.showIntroverts(this.invertedAxis,!0)):(this.cube.showIntroverts(this.axis,!0),this.cube.showIntroverts(this.invertedAxis,!0)):this.neighbour?(this.hideIntroverts(null,!0),this.neighbour.hideIntroverts(null,!0)):this.cube.hideIntroverts(null,!0)}this.matrix.makeRotationAxis(this.axis,t),this.axis.rotation=t,t=this.indices.length;for(var n=new i.Matrix4;t--;)e=this.getCubelet(t),e.matrix.multiplyMatrices(this.matrix,e.matrixSlice),e.position.setFromMatrixPosition(e.matrix),e.scale.setFromMatrixScale(e.matrix),n.extractRotation(e.matrix),e.quaternion.setFromRotationMatrix(n)},get rotation(){return this.axis.rotation},getLocation:function(t){return t===this.origin?"origin":t===this.north?"north":t===this.northEast?"northEast":t===this.east?"east":t===this.southEast?"southEast":t===this.south?"south":t===this.southWest?"southWest":t===this.west?"west":t===this.northWest?"northWest":!1},isSolved:function(e){if(e){var i,n={},r=this.indices.length,s=0;for(e instanceof t.Direction&&(e=e.name);0<r--;)i=this.getCubelet(r),i=i[e].color.name,void 0===n[i]?(n[i]=1,s++):n[i]++;return 1===s?!0:!1}return console.warn("A face [String or ERNO.Controls] argument must be specified when using ERNO.Group.isSolved()."),!1}}),t.Fold=function(t,e){this.map=[t.northWest[t.face].text,t.north[t.face].text,t.northEast[t.face].text,e.northWest[e.face].text,e.north[e.face].text,e.northEast[e.face].text,t.west[t.face].text,t.origin[t.face].text,t.east[t.face].text,e.west[e.face].text,e.origin[e.face].text,e.east[e.face].text,t.southWest[t.face].text,t.south[t.face].text,t.southEast[t.face].text,e.southWest[e.face].text,e.south[e.face].text,e.southEast[e.face].text]},t.Fold.prototype.getText=function(){var t="";return this.map.forEach(function(e){t+=e.innerHTML}),t},t.Fold.prototype.setText=function(t){var e;for(t=t.justifyLeft(18),e=0;18>e;e++)this.map[e].innerHTML=t.substr(e,1)},t.Projector=function(){return function(t,e){function n(t,e){return m.getInverse(e.projectionMatrix),o.multiplyMatrices(e.matrixWorld,m),t.applyProjection(o)}function r(i,r,o){var u=e,d=u!==document?u.getBoundingClientRect():{left:0,top:0,width:window.innerWidth,height:window.innerHeight};return u!==document&&(u=u.ownerDocument.documentElement,d.left+=window.pageXOffset-u.clientLeft,d.top+=window.pageYOffset-u.clientTop),s=d,h.x=(r-s.left)/s.width*2-1,h.y=(o-s.top)/s.height*-2+1,h.z=-1,c.set(h.x,h.y,1),n(h,i),n(c,i),c.sub(h).normalize(),l.set(h,c),a.getInverse(t.matrixWorld),l.applyMatrix4(a),l}var s,o=new i.Matrix4,a=new i.Matrix4,h=new i.Vector3,c=new i.Vector3(1,1,1),u=new i.Vector3,l=new i.Ray,d=new i.Box3,f=new i.Sphere,m=new i.Matrix4,p=h.distanceTo(c);return d.min.set(.5*-t.size,.5*-t.size,.5*-t.size),d.max.set(.5*t.size,.5*t.size,.5*t.size),f.radius=p*t.size*.5,{getIntersection:function(e,n,s,o,a){return o=o||new i.Vector3,null===n||null===s?null:(r(e,n,s),l.isIntersectionSphere(f)&&null!==l.intersectBox(d,o)?(a&&(e=u||new i.Vector3,e.copy(o).set(Math.round(e.x),Math.round(e.y),Math.round(e.z)).multiplyScalar(2/t.size).set(0|e.x,0|e.y,0|e.z),a.setFromNormalAndCoplanarPoint(u,o)),o):null)},getIntersectionOnPlane:function(t,e,i,n,s){return null===e||null===i?null:(r(t,e,i),l.intersectPlane(n,s))},getCubeletAtIntersection:function(){var e=new i.Vector3;return function(i){return e.copy(i).add(d.max).multiplyScalar(3/t.size).set(Math.min(0|e.x,2),Math.min(3-e.y|0,2),Math.min(3-e.z|0,2)),t.cubelets[9*e.z+3*e.y+e.x]}}()}}}(),t.Interaction=function(){return function(e,n,r,s,o){function a(t){z.enabled&&2!==t.button&&(f=(t.touches&&t.touches[0]||t).clientX,m=(t.touches&&t.touches[0]||t).clientY,p.getIntersection(n,f,m,y,w)&&(null!==t.touches&&t.preventDefault(),0===e.isTweening()&&(_="undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),z.active=!0,u=p.getCubeletAtIntersection(y),l=[e.slices[u.addressX+1],e.slices[u.addressY+4],e.slices[u.addressZ+7]],r.addEventListener("mousemove",h),r.addEventListener("touchmove",h),r.addEventListener("mouseup",c),r.addEventListener("touchcancel",c),r.addEventListener("touchend",c),r.removeEventListener("mousedown",a),r.removeEventListener("touchstart",a))))}function h(t){z.active&&(E.x=(t.touches&&t.touches[0]||t).clientX,E.y=(t.touches&&t.touches[0]||t).clientY),z.enabled&&(t.preventDefault(),t.stopImmediatePropagation())}function c(i){var n=(i.touches&&i.touches[0]||i).clientX,s=(i.touches&&i.touches[0]||i).clientY;z.active=!1,z.enabled&&(n!==m||s!==m)&&v&&(null!==i.touches&&i.preventDefault(),i=d.name[0].toUpperCase(),n=Math.round(D/Math.PI*2)*Math.PI*.5,.3<g.length()/(("undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now())-_)&&(n=Math.floor(D/Math.PI*2)*Math.PI*.5,n+=0<b.dot(g.normalize())?.5*Math.PI:0),e.twist(new t.Twist(i,n.radiansToDegrees()))),_=0,E.x=void 0,E.y=void 0,v=!1,d=null,r.removeEventListener("mousemove",h),r.removeEventListener("touchmove",h),r.removeEventListener("mouseup",c),r.removeEventListener("touchend",c),r.removeEventListener("touchcancel",c),r.addEventListener("mousedown",a),r.addEventListener("touchstart",a)}var u,l,d,f,m,p=new t.Projector(e,r),y=new i.Vector3,x=new i.Vector3,v=!1,w=new i.Plane,g=new i.Vector3,b=new i.Vector3,E=new i.Vector2;new i.Vector3;var M=new i.Vector3,D=0,_=0;E.x=void 0,E.y=void 0;var z={active:!1,enabled:!0,multiDrag:o||!1,multiDragSnapArea:100,dragSpeed:s||1.3};i.EventDispatcher.prototype.apply(z),z.getIntersectionAt=function(){var t=new i.Vector3,e=new i.Plane;return function(i,r){return null===p.getIntersection(n,i,r,t,e)?null:{cubelet:p.getCubeletAtIntersection(t),face:1===e.normal.x?"RIGHT":-1===e.normal.x?"LEFT":1===e.normal.y?"UP":-1===e.normal.y?"DOWN":1===e.normal.z?"FRONT":"BACK"}}}(),z.update=function(){var t=E.x,i=E.y;z.enabled&&z.active&&void 0!==t&&void 0!=i&&(f!==t||m!==i)&&(p.getIntersectionOnPlane(n,t,i,w,x),g.subVectors(x,y),!v&&5<g.length()&&(d&&(d.rotation=0),v=!0,M.crossVectors(w.normal,g),t=Math.max(Math.abs(M.x),Math.abs(M.y),Math.abs(M.z)),M.x=M.x/t|0,M.y=1===M.x?0:M.y/t|0,M.z=1===M.x||1===M.y?0:M.z/t|0,d=l[Math.abs(3*M.z+2*M.y+M.x)-1],b.crossVectors(d.axis,w.normal).normalize()),v&&(g.subVectors(x,y),D=b.dot(g)/e.size*z.dragSpeed),d&&(d.rotation=D))},r.addEventListener("mousedown",a),r.addEventListener("touchstart",a);var S,T,C=function(t,e){var i=this.getIntersectionAt(t,e);return i?(this.dispatchEvent(new CustomEvent("click",{detail:i})),!0):!1}.bind(z);return r.addEventListener("mousedown",function(t){S=t.clientX,T=t.clientY}),r.addEventListener("mouseup",function(t){var e=t.clientX;t=t.clientY,!v&&Math.abs(Math.sqrt((e-S)*(e-S)+(t-T)*(t-T)))<10*(window.devicePixelratio||1)&&C(S,T)}),r.addEventListener("touchstart",function(t){S=t.touches[0].clientX,T=t.touches[0].clientY}),r.addEventListener("touchend",function(t){var e=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY;!v&&Math.abs(Math.sqrt((e-S)*(e-S)+(i-T)*(i-T)))<10*(window.devicePixelratio||1)&&C(S,T)&&t.preventDefault()}),z}}(),t.Controls=function(){var e,n;return e=0,n=1,function(r,s,o){function a(t){v.enabled&&1===t.which&&null===x.getIntersection(s,t.pageX,t.pageY)&&(f=e,m.multiplyScalar(0),w(t.pageX,t.pageY,p),y.copy(p),v.domElement.removeEventListener("mousedown",a),document.addEventListener("mousemove",h),document.addEventListener("mouseup",c))}function h(t){v.enabled&&(t.preventDefault(),f=e,w(t.pageX,t.pageY,p),m.subVectors(p,y),y.copy(p))}function c(){document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",c),v.domElement.addEventListener("mousedown",a),v.enabled&&(f=n)}function u(t){v.enabled&&null===x.getIntersection(s,t.touches[0].pageX,t.touches[0].pageY)&&(f=e,m.multiplyScalar(0),w(t.touches[0].pageX,t.touches[0].pageY,p),y.copy(p),v.domElement.removeEventListener("touchstart",u),document.addEventListener("touchend",d),document.addEventListener("touchmove",l))
}function l(t){v.enabled&&(f=e,w(t.changedTouches[0].pageX,t.changedTouches[0].pageY,p),m.subVectors(p,y),y.copy(p))}function d(){document.removeEventListener("touchend",d),document.removeEventListener("touchmove",l),v.domElement.addEventListener("touchstart",u),v.enabled&&(f=n)}var f=-1,m=new i.Vector2,p=new i.Vector2;new i.Vector2;var y=new i.Vector2,x=new t.Projector(r,o),v={enabled:!0,domElement:o,rotationSpeed:4,damping:.25},w=function(t,e,i){var n;n=v.domElement,n=n!==document?n.getBoundingClientRect():{left:0,top:0,width:window.innerWidth,height:window.innerHeight};var r=window.devicePixelRatio||1;return i.set(.001*(t*r-n.width-n.left),.001*(n.height+n.top-e*r))};return v.update=function(){var t=new i.Vector3,o=0,a=new i.Matrix4;return function(){!1!==v.enabled&&-1!==f&&(t.set(m.y,-1*m.x,0).normalize(),a.getInverse(r.matrixWorld),a.multiply(s.matrixWorld),t.transformDirection(a),m.multiplyScalar(1-Math.max(0,Math.min(1,v.damping))),o=m.length(),r.object3D.rotateOnAxis(t,-o*v.rotationSpeed),f===e?f=-1:f===n&&o>=1e-4?p.add(m):f=-1)}}(),v.domElement.addEventListener("mousedown",a),v.domElement.addEventListener("touchstart",u),v}}();var u=i.Scene;i.Scene=u||function(){},t.renderers=t.renderers||{},t.renderers.CSS3D=function(e,n){function r(t){t.style.display="block"}function s(t){t.style.display="none"}function o(){return Array.prototype.slice.call(h.domElement.querySelectorAll(".faceLabel"))}function a(){if(n.domElement.parentNode){var t=n.domElement.parentNode.clientWidth,e=n.domElement.parentNode.clientHeight;!n.domElement.parentNode||n.domElement.clientWidth===t&&n.domElement.clientHeight===e||n.setSize(t,e),h.render(c,n.camera)}requestAnimationFrame(a)}var h=new i.CSS3DRenderer,c=new i.Object3D;h.scene=c,c.add(n.autoRotateObj3D),c.add(n.camera);var l;return new i.Vector3,n.faces.forEach(function(t){l=n[t.face].label=new i.CSS3DObject(document.createElement("div")),l.element.classList.add("faceLabel"),l.position.copy(t.axis).multiplyScalar(n.size),l.position.negate(),l.element.innerHTML=t.face.toUpperCase(),n.object3D.add(l)}),n.right.label.rotation.y=.5*Math.PI,n.left.label.rotation.y=-.5*Math.PI,n.back.label.rotation.y=Math.PI,n.up.label.rotation.x=-.5*Math.PI,n.down.label.rotation.x=.5*Math.PI,n.showFaceLabels=function(){return o().forEach(r),this.showingFaceLabels=!0,this},n.hideFaceLabels=function(){return o().forEach(s),this.showingFaceLabels=!1,this},t.extend(t.Cubelet.prototype,t.renderers.CSS3DCubelet.methods),e.forEach(t.renderers.CSS3DCubelet),requestAnimationFrame(a),u&&(i.Scene=u),h},t.renderers.CSS3DCubelet=function(){return function(e){var n=document.createElement("div");n.classList.add("cubelet"),n.classList.add("cubeletId-"+e.id),e.css3DObject=new i.CSS3DObject(n),e.css3DObject.name="css3DObject-"+e.id,e.add(e.css3DObject);var n=e.size/2,r=["rotateX(   0deg ) translateZ( "+n+"px ) rotateZ(   0deg )","rotateX(  90deg ) translateZ( "+n+"px ) rotateZ(   0deg )","rotateY(  90deg ) translateZ( "+n+"px ) rotateZ(   0deg )","rotateX( -90deg ) translateZ( "+n+"px ) rotateZ(  90deg )","rotateY( -90deg ) translateZ( "+n+"px ) rotateZ( -90deg )","rotateY( 180deg ) translateZ( "+n+"px ) rotateZ( -90deg )"],s="axisZ axisY axisX axisY axisX axisZ".split(" ");e.faces.forEach(function(i){i.element=document.createElement("div"),i.element.classList.add("face"),i.element.classList.add(s[i.id]),i.element.classList.add("face"+t.Direction.getNameById(i.id).capitalize()),e.css3DObject.element.appendChild(i.element);var n=document.createElement("div");n.classList.add("wireframe"),i.element.appendChild(n),n=document.createElement("div"),n.classList.add("id"),i.element.appendChild(n);var o=document.createElement("span");o.classList.add("underline"),o.innerText=e.id,n.appendChild(o),n=i.element.style,n.OTransform=n.MozTransform=n.WebkitTransform=n.transform=r[i.id],i.isIntrovert?(i.element.classList.add("faceIntroverted"),i.element.appendChild(document.createElement("div"))):(i.element.classList.add("faceExtroverted"),n=document.createElement("div"),n.classList.add("sticker"),n.classList.add(i.color.name),i.element.appendChild(n),e.isStickerCubelet&&n.classList.add("stickerLogo"),n=document.createElement("div"),n.classList.add("text"),n.innerText=i.id,i.text=n,i.element.appendChild(n))}),e.show(),e.showIntroverts(),e.showPlastics(),e.showStickers(),e.hideIds(),e.hideTexts(),e.hideWireframes()}}(),t.renderers.CSS3DCubelet.methods=function(){function t(t){t.style.display="block"}function n(t){t.style.display="none"}return{getFaceElements:function(t){return Array.prototype.slice.call(this.css3DObject.element.querySelectorAll(".face"+(t||"")))},show:function(){t(this.css3DObject.element),this.showing=!0},hide:function(){n(this.css3DObject.element),this.showing=!1},showExtroverts:function(){this.getFaceElements(".faceExtroverted").forEach(t),this.showingExtroverts=!0},hideExtroverts:function(){this.getFaceElements(".faceExtroverted").forEach(n),this.showingExtroverts=!1},showIntroverts:function(){var e,n=new i.Vector3,r=new i.Matrix4;return function(i,s){e="",i&&(r.getInverse(this.matrix),n.copy(i).transformDirection(r),e=1===Math.abs(Math.round(n.x))?".axisX":1===Math.round(Math.abs(n.y))?".axisY":".axisZ"),this.getFaceElements(".faceIntroverted"+(void 0!==i?e:"")).forEach(t),s||(this.showingIntroverts=!0)}}(),hideIntroverts:function(){var t,e=new i.Vector3,r=new i.Matrix4;return function(i,s){t="",i&&(r.getInverse(this.matrix),e.copy(i).transformDirection(r),t=1===Math.abs(Math.round(e.x))?".axisX":1===Math.round(Math.abs(e.y))?".axisY":".axisZ"),this.getFaceElements(".faceIntroverted"+(void 0!==i?t:"")).forEach(n),s||(this.showingIntroverts=!1)}}(),showPlastics:function(){this.getFaceElements().forEach(function(t){t.classList.remove("faceTransparent")}),this.showingPlastics=!0},hidePlastics:function(){this.getFaceElements().forEach(function(t){t.classList.add("faceTransparent")}),this.showingPlastics=!1},hideStickers:function(){this.getFaceElements(" .sticker").forEach(n),this.showingStickers=!1},showStickers:function(){this.getFaceElements(" .sticker").forEach(t),this.showingStickers=!0},showWireframes:function(){this.getFaceElements(" .wireframe").forEach(t),this.showingWireframes=!0},hideWireframes:function(){this.getFaceElements(" .wireframe").forEach(n),this.showingWireframes=!1},showIds:function(){this.getFaceElements(" .id").forEach(t),this.showingIds=!0},hideIds:function(){this.getFaceElements(" .id").forEach(n),this.showingIds=!1},showTexts:function(){this.getFaceElements(" .text").forEach(t),this.showingTexts=!0},hideTexts:function(){this.getFaceElements(" .text").forEach(n),this.showingTexts=!1},getOpacity:function(){return this.opacity},setOpacity:function(t,i){if(this.opacityTween&&this.opacityTween.stop(),void 0===t&&(t=1),t!==this.opacity){var n=this,r=(t-this.opacity).absolute().scale(0,1,0,200);this.opacityTween=new e.Tween({opacity:this.opacity}).to({opacity:t},r).easing(e.Easing.Quadratic.InOut).onUpdate(function(){n.css3DObject.element.style.opacity=this.opacity,n.opacity=this.opacity}).onComplete(function(){i instanceof Function&&i()}).start()}},getStickersOpacity:function(){return parseFloat(this.getFaceElements(" .sticker")[0].style.opacity)},setStickersOpacity:function(t){void 0===t&&(t=.2);var e=t;this.getFaceElements(" .sticker").forEach(function(t){t.style.opacity=e.toString()})}}}(),t.Cube=function(e){t.Group.call(this),e=e||{},this.paused=void 0===e.paused?!1:e.paused,this.autoRotate=void 0===e.autoRotate?!1:e.autoRotate,this.keyboardControlsEnabled=void 0===e.keyboardControlsEnabled?!0:e.keyboardControlsEnabled,this.mouseControlsEnabled=void 0===e.mouseControlsEnabled?!0:e.mouseControlsEnabled;var n=e.renderer||t.renderers.CSS3D;e.textureSize=void 0===e.textureSize?120:e.textureSize,this.isShuffling=!1,this.isReady=!0,this.undoing=this.isSolving=!1,this.render=!0,this.finalShuffle=null,this.hideInvisibleFaces=void 0===e.hideInvisibleFaces?!1:e.hideInvisibleFaces,this.moveCounter=this.time=0,this.taskQueue=new t.Queue,this.twistQueue=new t.Queue(t.Twist.validate),this.historyQueue=new t.Queue(t.Twist.validate),this.twistDuration=void 0!==e.twistDuration?e.twistDuration:500,this.shuffleMethod=this.PRESERVE_LOGO,this.size=3*e.textureSize,this.cubeletSize=this.size/3,this.camera=new i.PerspectiveCamera(35,window.innerWidth/window.innerHeight,1,6e3),this.camera.position.z=4*this.size,this.object3D=new i.Object3D,this.autoRotateObj3D=new i.Object3D,this.rotation=this.object3D.rotation,this.quaternion=this.object3D.quaternion,this.position=this.object3D.position,this.matrix=this.object3D.matrix,this.matrixWorld=this.object3D.matrixWorld,this.rotation.set(25*Math.PI/180,-30*Math.PI/180,0),this.rotationDelta=new i.Euler(.1*Math.PI/180,.15*Math.PI/180,0),this.cubelets=[],[[r,s,,,h],[r,s,,,,],[r,s,o,,,],[r,,,,h],[r,,,,,],[r,,o,,,],[r,,,a,h],[r,,,a,,],[r,,o,a,,],[,s,,,h],[,s,,,,],[,s,o,,,],[,,,,h],[,,,,,],[,,o,,,],[,,,a,h],[,,,a,,],[,,o,a,,],[,s,,,h,c],[,s,,,,c],[,s,o,,,c],[,,,,h,c],[,,,,,c],[,,o,,,c],[,,,a,h,c],[,,,a,,c],[,,o,a,,c]].forEach(function(e,i){this.cubelets.push(new t.Cubelet(this,i,e))}.bind(this)),this.core=new t.Group,this.centers=new t.Group,this.edges=new t.Group,this.corners=new t.Group,this.crosses=new t.Group,this.cubelets.forEach(function(t){"core"===t.type&&this.core.add(t),"center"===t.type&&this.centers.add(t),"edge"===t.type&&this.edges.add(t),"corner"===t.type&&this.corners.add(t),"center"!==t.type&&"edge"!==t.type||this.crosses.add(t)}.bind(this)),this.left=new t.Slice([24,21,18,15,12,9,6,3,0],this),this.left.name="left",this.middle=new t.Slice([25,22,19,16,13,10,7,4,1],this),this.middle.name="middle",this.right=new t.Slice([2,11,20,5,14,23,8,17,26],this),this.right.name="right",this.right.neighbour=this.middle,this.left.neighbour=this.middle,this.up=new t.Slice([18,19,20,9,10,11,0,1,2],this),this.up.name="up",this.equator=new t.Slice([21,22,23,12,13,14,3,4,5],this),this.equator.name="equator",this.down=new t.Slice([8,17,26,7,16,25,6,15,24],this),this.down.name="down",this.down.neighbour=this.equator,this.up.neighbour=this.equator,this.front=new t.Slice([0,1,2,3,4,5,6,7,8],this),this.front.name="front",this.standing=new t.Slice([9,10,11,12,13,14,15,16,17],this),this.standing.name="standing",this.back=new t.Slice([26,23,20,25,22,19,24,21,18],this),this.back.name="back",this.back.neighbour=this.standing,this.front.neighbour=this.standing,this.faces=[this.front,this.up,this.right,this.down,this.left,this.back],this.slices=[this.left,this.middle,this.right,this.down,this.equator,this.up,this.back,this.standing,this.front];var u=function(t){this.dispatchEvent(new CustomEvent("onTwistComplete",{detail:{slice:t.target}}))}.bind(this);this.slices.forEach(function(t){t.addEventListener("change",u)});var l=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26];this.slicesDictionary={f:this.front,s:this.standing,b:this.back,u:this.up,e:this.equator,d:this.down,r:this.right,m:this.middle,l:this.left,x:new t.Slice(l,this),y:new t.Slice(l,this),z:new t.Slice(l,this)},this.slicesDictionary.x.ableToHideInternalFaces=!1,this.slicesDictionary.y.ableToHideInternalFaces=!1,this.slicesDictionary.z.ableToHideInternalFaces=!1,this.slicesDictionary.x.axis.set(-1,0,0),this.slicesDictionary.y.axis.set(0,-1,0),this.slicesDictionary.z.axis.set(0,0,-1),this.cubelets.forEach(function(t,e){t.setAddress(e)}),this.renderer=n(this.cubelets,this),this.domElement=this.renderer.domElement,this.domElement.classList.add("cube"),this.domElement.style.fontSize=this.cubeletSize+"px",this.autoRotateObj3D.add(this.object3D),this.hideInvisibleFaces&&this.hideIntroverts(null,!0),this.mouseInteraction=new t.Interaction(this,this.camera,this.domElement),this.mouseInteraction.addEventListener("click",function(t){this.dispatchEvent(new CustomEvent("click",{detail:t.detail}))}.bind(this)),this.controls=new(e.controls||t.Controls)(this,this.camera,this.domElement),this.folds=[new t.Fold(this.front,this.right),new t.Fold(this.left,this.up),new t.Fold(this.down,this.back)],this.setSize(400,200),this.loop=this.loop.bind(this),requestAnimationFrame(this.loop),document.addEventListener("keypress",function(t){"input"!==t.target.tagName.toLowerCase()&&"textarea"!==t.target.tagName.toLowerCase()&&!this.mouseInteraction.active&&this.keyboardControlsEnabled&&(t=String.fromCharCode(t.which),0<="XxRrMmLlYyUuEeDdZzFfSsBb".indexOf(t)&&this.twist(t))}.bind(this))},t.Cube.prototype=Object.create(t.Group.prototype),t.Cube.prototype.constructor=t.Cube,t.extend(t.Cube.prototype,{shuffle:function(e,i){e=e||30,i=i||"";var n,r,s=this.shuffleMethod.slice(),o=new t.Twist,a=i.length,h=0;for(this.twistQueue.empty(!0),this.historyQueue.empty(!0);0<e--;){if(i)n.set(i[h]),h=(h+1)%a;else for(r=s.split(""),n=(new t.Twist).copy(o);n.equals(o);)n.set(r.splice(Math.floor(Math.random()*r.length),1)[0]);n.isShuffle=!0,this.twist(n),o=n.getInverse()}this.finalShuffle=n},solve:function(){this.isSolving=!0},isSolved:function(){return this.front.isSolved(t.Direction.FRONT)&&this.up.isSolved(t.Direction.UP)&&this.right.isSolved(t.Direction.RIGHT)&&this.down.isSolved(t.Direction.DOWN)&&this.left.isSolved(t.Direction.LEFT)&&this.back.isSolved(t.Direction.BACK)},undo:function(){0<this.twistQueue.history.length&&(this.historyQueue.add(this.twistQueue.undo().getInverse()),this.undoing=!0)},redo:function(){0<this.twistQueue.future.length&&(this.undoing=!0,this.historyQueue.empty(),this.historyQueue.add(this.twistQueue.redo()))},twist:function(t){this.undoing&&this.twistQueue.empty(),this.historyQueue.empty(),this.undoing=!1,this.twistQueue.add(t)},immediateTwist:function(t){.8<=this.verbosity&&console.log("Executing a twist command to rotate the "+t.group+" "+t.wise+" by",t.degrees,"degrees.");for(var i,n=this.slicesDictionary[t.command.toLowerCase()],r=(void 0===t.degrees?90:t.degrees)*t.vector,s=r.degreesToRadians(),o=Math.abs(s-n.rotation)/(.5*Math.PI)*this.twistDuration,a=n.indices.length;0<a--;)n.getCubelet(a).isTweening=!0;new e.Tween(n).to({rotation:s},o).easing(e.Easing.Quartic.Out).onComplete(function(){for(n.rotation=s,n.axis.rotation=0,a=n.indices.length;0<a--;)i=n.getCubelet(a),i.isTweening=!1,i.updateMatrix(),i.matrixSlice.copy(i.matrix);0!==r&&(n.rotateGroupMappingOnAxis(s),this.dispatchEvent(new CustomEvent("onTwistComplete",{detail:{slice:n,twist:t}}))),t===this.finalShuffle&&(this.finalShuffle=null,this.dispatchEvent(new CustomEvent("onShuffleComplete",{detail:{slice:n,twist:t}})))}.bind(this)).start(this.time)},getText:function(t){return void 0===t?[this.folds[0].getText(),this.folds[1].getText(),this.folds[2].getText()]:n.isNumeric(t)&&t>=0&&2>=t?this.folds[t].getText():void 0},setText:function(t,e){void 0===e?(this.folds[0].setText(t),this.folds[1].setText(t),this.folds[2].setText(t)):n.isNumeric(e)&&e>=0&&2>=e&&this.folds[e].setText(t)},setSize:function(t,e){this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e)},PRESERVE_LOGO:"RrLlUuDdSsBb",ALL_SLICES:"RrMmLlUuEeDdFfSsBb",EVERYTHING:"XxRrMmLlYyUuEeDdZzFfSsBb",loop:function(){var t=0;return function(){requestAnimationFrame(this.loop);var i="undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),n=i-(t||i);t=i,this.paused||(this.time+=n,e.update(this.time),this.autoRotate&&(this.rotation.x+=this.rotationDelta.x,this.rotation.y+=this.rotationDelta.y,this.rotation.z+=this.rotationDelta.z),this.isReady&&0===this.isTweening()&&(i=this.undoing?this.historyQueue:this.twistQueue,0===i.future.length?this.isSolving&&window.solver?this.isSolving=window.solver.consider(this):!0===this.taskQueue.isReady&&(i=this.taskQueue.do(),i instanceof Function&&i()):(n=i.do(),"x"!==n.command.toLowerCase()&&"y"!==n.command.toLowerCase()&&"z"!==n.command.toLowerCase()&&0!==n.degrees&&(this.moveCounter+=this.undoing?-1:1),(0===n.degrees||n.isShuffle)&&i.purge(n),this.immediateTwist(n))),this.mouseInteraction.enabled=this.mouseControlsEnabled&&!this.finalShuffle,this.mouseInteraction.update(),this.controls.enabled=this.mouseControlsEnabled&&!this.mouseInteraction.active,this.controls.update())}}()}),t.Solver=function(){this.logic=function(){return!1}},t.Solver.prototype.consider=function(e){return void 0===e?(console.warn("A cube [Cube] argument must be specified for Solver.consider()."),!1):!1==e instanceof t.Cube?(console.warn("The cube argument provided is not a valid Cube."),!1):(e.isShuffling=!1,e.isSolved()?(t.Solver.prototype.explain("I’ve found that the cube is already solved."),!1):this.logic(e))},t.Solver.prototype.hint=function(t){console.log("%c"+t+"%c\n","background-color: #EEE; color: #333","")},t.Solver.prototype.explain=function(t){console.log("Solver says: %c "+t+" %c\n","color: #080","")},window.ERNO=t,window._=n,window.TWEEN=window.TWEEN||e,window.THREE=window.THREE||i}();

(function($) {
  //plugin start
  var scram, algo, algor, ths;
  window.cube = new ERNO.Cube();
  cube.rotation.y = -0.8;
  cube.keyboardControlsEnabled = true;
  cube.core.setOpacity(0);

  //alg parsers
  function algparse(s) {
    var x = [];
    s.trim().replace(/{|}|\[|\]\(|\)/g, '').split(/\s+/).forEach(function(e) {
      if (e.length === 2) {
        //180deg
        if (e[1] === '2') {
          x.push(new ERNO.Twist(e[0], 180));
        }
        //inverse
        else {
          x.push(e[0].toLowerCase());
        }
      }
      //inverse 180deg
      else if (e.length === 3) {
        x.push(new ERNO.Twist(e[0].toLowerCase(), 180));
      }
      //default
      else {
        x.push(e[0]);
      }
    });
    return x;
  }

  function algparseinv(s) {
    var x = [];
    s.trim().replace(/{|}|\[|\]\(|\)/g, '').split(/\s+/).reverse().forEach(function(e) {
      if (e.length === 2) {
        //180deg
        if (e[1] === '2') {
          x.push(new ERNO.Twist(e[0].toLowerCase(), 180));
        }
        //inverse
        else {
          x.push(e[0].toUpperCase());
        }
      }
      //inverse 180deg
      else if (e.length === 3) {
        x.push(new ERNO.Twist(e[0].toUpperCase(), 180));
      }
      //default
      else {
        x.push(e[0].toLowerCase());
      }
    });
    return x;
  }
  
  //make new cube
  $.fn.gcube = function(callback) {
    this.filter('g-cube').each(function() {
      //cube container
      $(this).append('<div class="cubecont"></div>');
      $(this).find('.cubecont').append(cube.domElement);
    });
    if(typeof callback == 'function'){
      callback();
    }
    return this;
  }
  //change speed
  $.fn.gspeed = function(x) {
    this.filter('g-cube').each(function() {
      if (x.length) {
        cube.twistDuration = x;
      } else {
        cube.twistDuration = 10;
      }
    });
    return this;
  };
  //change scramble
  $.fn.gscramble = function(x) {
    if (x.length) {
      this.filter('g-cube').each(function() {
        scram = algparse(x.replace(/\/random/i, '').replace(/\/2-genR/i, '').replace(/\/2-genL/i, '').replace(/\/2-genM/i, '').replace(/\/3-genRF/i, '').replace(/\/3-genLF/i, '').replace(/\/3-genRL/i, ''));
        if (x.match('/random')) {
          if (x.match('/2-genR')) {
            cube.shuffleMethod = 'RrUu';
          } else if (x.match('/2-genM')) {
            cube.shuffleMethod = 'MmUu';
          } else if (x.match('/2-genL')) {
            cube.shuffleMethod = 'RrUu';
          } else if (x.match('/3-genRF')) {
            cube.shuffleMethod = 'RrUuFf';
          } else if (x.match('/3-genLF')) {
            cube.shuffleMethod = 'LlUuFf';
          } else if (x.match('/3-genRL')) {
            cube.shuffleMethod = 'RrUuLl';
          } else {
            cube.shuffleMethod = 'RrLlUuDdFfBb';
          }
          cube.shuffle(25);
        } else {
          cube.twist(scram);
        }
      });
    }
    return this;
  };
  //change alg
  $.fn.galgorithm = function(x) {
    if (x.length) {
      this.filter('g-cube').each(function() {
        algo = algparse(x);
        algor = algparseinv(x);
        cube.mouseControlsEnabled = false;
        $(this).children('button, input, span').remove();
        $(this).prepend('<button class="playalg" style="top: 0; z-index: 100">Play Algorithm</button><br><span>Speed:</span><input class="speedslider" type="range" min="10" max="1500" value="500">');
        $(this).children('.playalg').click(function() {
          if ($(this).text() == 'Play Algorithm') {
            cube.twistDuration = $('.speedslider').val();
            $(this).text('Reverse Algorithm');
            cube.twist(algo);
          } else {
            cube.twistDuration = 10;
            cube.twist(algor);
            $(this).text('Play Algorithm');
          }
        });
      });
    }
    return this;
  };
  
  /* Create a map of highlighting methods. In the context of these highlighting functions,
    'this' is the ERNO.Cube instance. These are kept private so that
    $(cube).g-highlight(x) is used instead of a call to cube.hideStickers() and one of these functions. */
  var highlighters = {
    /** Only show the edge cubelets. */
    "edges": function() {
      this.edges.showStickers();
      this.centers.hideStickers();
      this.corners.hideStickers();
    },
    /** Only show the corner cubelets. */
    "corners": function() {
      this.corners.showStickers();
      this.edges.hideStickers();
      this.centers.hideStickers();
    },
    /** Only show the center cubelets. */
    "centers": function() {
      this.centers.showStickers();
      this.edges.hideStickers();
      this.corners.hideStickers();
    },
    /** Only show the down face's edges and the cube's centers. */
    "flcross": function() {
      this.down.cross.showStickers();
      this.centers.showStickers();
      this.rotation.x = 100;
    },
    /** Only show the down face's edges, the cube's centers, and the corner-edge pair in the
        Front-Right-Down position. */
    "flxcross": function() {
      this.down.cross.showStickers();
      this.centers.showStickers();
      this.hasId(5).showStickers();
      this.hasId(8).showStickers();
      this.rotation.x = 100;
    },
    /** Only show the cubelets on the down face and the cube's centers. */
    "fl": function() {
      this.down.showStickers();
      this.centers.showStickers();
      this.rotation.x = 100;
    },
    /** Only show the corners of the first layer, and put the down face in view of the camera. */
    "cfl": function() {
      this.down.corners.showStickers();
      this.rotation.x = 100;
    },
    /** Only show the cubelets in the "middle" slice and the cube's centers. */
    "belt": function() {
      this.equator.showStickers();
      this.centers.showStickers();
    },
    /** Only show the first two layers of the cube (the down face and the middle slice)
        and the center of the up face. Also put the down face in view of the camera. */
    "f2l": function() {
      this.showStickers();
      this.up.hideStickers();
      this.centers.showStickers();
      this.rotation.x = 100;
    },
    /** Shows all the stickers except for the ring of stickers on the up slice that don't face up. */
    "oll": function() {
      this.showEdgeStickersOnUpFace();
      this.showCornerStickersOnUpFace();
      this.centers.showStickers();
      this.equator.showStickers();
      this.down.showStickers();
    },
    /** Show all the stickers on the down and equator slices, as well as the stickers facing up on
        edges on the up face, and also the up face's center sticker. */
    "eoll": function() {
      this.showEdgeStickersOnUpFace();
      this.centers.showStickers();
      this.equator.showStickers();
      this.down.showStickers();
    },
    /** Show all the stickers on the down and equator slices, as well as the stickers facing up on
        corners on the up face, ans also the up face's center sticker. */
    "ocll": function() {
      this.showCornerStickersOnUpFace();
      this.centers.showStickers();
      this.equator.showStickers();
      this.down.showStickers();
    },
    /** Show all the stickers except for stickers on edge cubelets on the up slice which don't face up. */
    "coll": function() {
      this.showEdgeStickersOnUpFace();
      this.centers.showStickers();
      this.up.corners.showStickers();
      this.equator.showStickers();
      this.down.showStickers();
    },
    /** Show the stickers on all cubelets, and hide stickers on the edge cubelets of the up slice. */
    "cll": function() {
      this.showStickers();
      this.up.edges.hideStickers();
    },
    /** Only show the centers and a 2x2x2 block in the down-front-right position,
        and put the down face in view of the camera. */
    "2x2x2": function() {
      this.showStickers();
      this.up.hideStickers();
      this.back.hideStickers();
      this.left.hideStickers();
      this.centers.showStickers();
      this.rotation.x = 100;
    },
    /** Only show the centers and a 2x2x3 block along the down-front edge.
        Put the down face in view of the camera. */
    "2x2x3": function() {
      this.showStickers();
      this.up.hideStickers();
      this.back.hideStickers();
      this.centers.showStickers();
      this.rotation.x = 100;
    },
    /** Only show the centers and the cubelets on the middle slice which are not also on the up slice. */
    "eoline": function() {
      this.showStickers();
      this.up.hideStickers();
      this.left.hideStickers();
      this.right.hideStickers();
      this.centers.showStickers();
      this.rotation.x = 100;
    },
    /** Only show the cubelets on the right slice which are not also on the up slice.
        Put the down face in view of the camera. */
    "fb": function() {
      this.right.showStickers();
      this.up.hideStickers();
      this.rotation.x = 100;
    },
    /** Only show the cubelets on the right and left slice which are not also on the up slice.
        Put the down face in view of the camera. */
    "f2b": function() {
      this.right.showStickers();
      this.left.showStickers();
      this.up.hideStickers();
      this.rotation.x = 100;
    },
    /** Show all cubelets except for cubelets on the middle slice and the edges on the up slice. */
    "cmll": function() {
      this.right.showStickers();
      this.left.showStickers();
      this.up.hideStickers();
      this.up.corners.showStickers();
    }
  };
  
  //change state/highlight
  $.fn.ghighlight = function(x) {
    if (x.length) {
      this.filter('g-cube').each(function() {
        cube.hideStickers();
        ths = $(this);
        x = x.toLowerCase();
        if (highlighters.hasOwnProperty(x)) {
          highlighters[x].apply(cube);
        } else {
          cube.showStickers();
        }
      });
    }
    return this;
  };
  //change text
  $.fn.gtext = function(x) {
    this.filter('g-cube').each(function() {
      cube.showTexts();
      cube.folds[0].setText(x);
      cube.folds[1].setText('');
      cube.folds[2].setText('');
      if (x.length) {
        cube.rotation.x = 50.2;
      }
    });
    return this;
  };
  //change florian
  $.fn.gflorian = function(e,f) {
    this.filter('g-cube').each(function() {
      var x = '0.1em';
      var y = '0.1em';
      $(this).children('style').remove();
      if (e.length) {
        x = e;
      }
      if (f.length) {
        y = f;
      }
      //this is gonna be really messy...
      $(this).prepend('<style>'+
      '.cube .cubeletId-0 .faceFront .sticker {  border-radius: ' + y + ' ' + y + ' ' + x + ' ' + y + ';}'+
      '.cube .cubeletId-0 .faceUp .sticker {  border-radius: ' + y + ' ' + x + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-0 .faceLeft .sticker {  border-radius: ' + x + ' ' + y + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-1 .faceFront .sticker {  border-radius: ' + y + ' ' + y + ' ' + x + ' ' + x + ';}'+
      '.cube .cubeletId-1 .faceUp .sticker {  border-radius: ' + x + ' ' + x + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-2 .faceFront .sticker {  border-radius: ' + y + ' ' + y + ' ' + y + ' ' + x + ';}'+
      '.cube .cubeletId-2 .faceUp .sticker {  border-radius: ' + y + ' ' + x + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-2 .faceRight .sticker {  border-radius: ' + y + ' ' + y + ' ' + x + ' ' + y + ';}'+
      '.cube .cubeletId-3 .faceFront .sticker {  border-radius: ' + y + ' ' + x + ' ' + x +' ' + y + ';}'+
      '.cube .cubeletId-3 .faceLeft .sticker {  border-radius: ' + x + ' ' + x + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-4 .faceFront .sticker {  border-radius: ' + x + ';}'+
      '.cube .cubeletId-5 .faceFront .sticker {  border-radius: ' + x + ' ' + y + ' ' + y + ' ' + x + ';}'+
      '.cube .cubeletId-5 .faceRight .sticker {  border-radius: ' + y + ' ' + x + ' ' + x +' ' + y + ';}'+
      '.cube .cubeletId-6 .faceFront .sticker {  border-radius: ' + y + ' ' + x + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-6 .faceDown .sticker {  border-radius: ' + y + ' ' + x + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-6 .faceLeft .sticker {  border-radius: ' + y + ' ' + x + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-7 .faceFront .sticker {  border-radius: ' + x + ' ' + x + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-7 .faceDown .sticker {  border-radius: ' + y + ' ' + x + ' ' + x +' ' + y + ';}'+
      '.cube .cubeletId-8 .faceFront .sticker {  border-radius: ' + x + ' ' + y + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-8 .faceDown .sticker {  border-radius: ' + y + ' ' + y + ' ' + x + ' ' + y + ';}'+
      '.cube .cubeletId-8 .faceRight .sticker {  border-radius: ' + y + ' ' + x + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-9 .faceUp .sticker {  border-radius: ' + y + ' ' + x + ' ' + x +' ' + y + ';}'+
      '.cube .cubeletId-9 .faceLeft .sticker {  border-radius: ' + x + ' ' + y + ' ' + y + ' ' + x + ';}'+
      '.cube .cubeletId-10 .faceUp .sticker {  border-radius: ' + x + ';}'+
      '.cube .cubeletId-11 .faceUp .sticker {  border-radius: ' + x + ' ' + y + ' ' + y + ' ' + x + ';}'+
      '.cube .cubeletId-11 .faceRight .sticker {  border-radius: ' + y + ' ' + y + ' ' + x + ' ' + x + ';}'+
      '.cube .cubeletId-12 .faceLeft .sticker {  border-radius: ' + x + ';}'+
      '.cube .cubeletId-14 .faceRight .sticker {  border-radius: ' + x + ';}'+
      '.cube .cubeletId-15 .faceDown .sticker {  border-radius: ' + x + ' ' + x + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-15 .faceLeft .sticker {  border-radius: ' + y + ' ' + x + ' ' + x + ' ' + y + ';}'+
      '.cube .cubeletId-16 .faceDown .sticker {  border-radius: ' + x + ';}'+
      '.cube .cubeletId-17 .faceDown .sticker {  border-radius: ' + y + ' ' + y + ' ' + x + ' ' + x + ';}'+
      '.cube .cubeletId-17 .faceRight .sticker {  border-radius: ' + x + ' ' + x + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-18 .faceBack .sticker {  border-radius: ' + x + ' ' + y + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-18 .faceUp .sticker {  border-radius: ' + y + ' ' + y + ' ' + x + ' ' + y + ';}'+
      '.cube .cubeletId-18 .faceLeft .sticker {  border-radius: ' + y + ' ' + y + ' ' + y + ' ' + x + ';}'+
      '.cube .cubeletId-19 .faceUp .sticker {  border-radius: ' + y + ' ' + y + ' ' + x + ' ' + x + ';}'+
      '.cube .cubeletId-19 .faceBack .sticker {  border-radius: ' + x + ' ' + y + ' ' + y + ' ' + x + ';}'+
      '.cube .cubeletId-20 .faceUp .sticker {  border-radius: ' + y + ' ' + y + ' ' + y + ' ' + x + ';}'+
      '.cube .cubeletId-20 .faceBack .sticker {  border-radius: ' + y + ' ' + y + ' ' + y + ' ' + x + ';}'+
      '.cube .cubeletId-20 .faceRight .sticker {  border-radius: ' + y + ' ' + y + ' ' + y + ' ' + x + ';}'+
      '.cube .cubeletId-21 .faceBack .sticker {  border-radius: ' + x + ' ' + x + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-21 .faceLeft .sticker {  border-radius: ' + y + ' ' + y + ' ' + x + ' ' + x + ';}'+
      '.cube .cubeletId-22 .faceBack .sticker {  border-radius: ' + x + ';}'+
      '.cube .cubeletId-23 .faceBack .sticker {  border-radius: ' + y + ' ' + y + ' ' + x + ' ' + x + ';}'+
      '.cube .cubeletId-23 .faceRight .sticker {  border-radius: ' + x + ' ' + y + ' ' + y + ' ' + x + ';}'+
      '.cube .cubeletId-24 .faceBack .sticker {  border-radius: ' + y + ' ' + x + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-24 .faceDown .sticker {  border-radius: ' + x + ' ' + y + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-24 .faceLeft .sticker {  border-radius: ' + y + ' ' + y + ' ' + x + ' ' + y + ';}'+
      '.cube .cubeletId-25 .faceBack .sticker {  border-radius: ' + y + ' ' + x + ' ' + x +' ' + y + ';}'+
      '.cube .cubeletId-25 .faceDown .sticker {  border-radius: ' + x + ' ' + y + ' ' + y + ' ' + x + ';}'+
      '.cube .cubeletId-26 .faceRight .sticker {  border-radius: ' + x + ' ' + y + ' ' + y + ' ' + y + ';}'+
      '.cube .cubeletId-26 .faceDown .sticker {  border-radius: ' + y + ' ' + y + ' ' + y + ' ' + x + ';}'+
      '.cube .cubeletId-26 .faceBack .sticker {  border-radius: ' + y + ' ' + y + ' ' + x + ' ' + y + ';}</style>');
    });
    return this;
  };
  
  // Add the last layer highlighting functions to the Cube class.
  ERNO.extend(ERNO.Cube.prototype, {
    /* The DOM of the cube.domElement element isn't fully constructed until the render method (cuber/src/scripts/renderer.js:115) is called.
      This function is queued with a call to requestAnimationFrame immediately following the function's definition, and this happens during
      the call to  new ERNO.Cube(). The render function isn't guaranteed to have been called at any point in this code, so we need a way to
      wait for it to be called before continuing. The solution used here is to call requestAnimationFrame with a callback that executes the
      rest of our code. Multiple requestAnimationFrame callbacks are called in the order they are requested, so because we are requesting
      the callback after the render callback, we can be sure that this code will be executed after the render code. */
      
    showEdgeStickersOnUpFace: function() {
      var cube = this;
      requestAnimationFrame(function() {
        var edgeCubeletsOnUpFace = $(cube.domElement).find('.cubeletId-1, .cubeletId-11, .cubeletId-19, .cubeletId-9');
        var edgeStickersOnUpFace = edgeCubeletsOnUpFace.find('.sticker.orange');
        edgeStickersOnUpFace.css('display', 'block');
      });
    },
    
    showCornerStickersOnUpFace: function() {
      var cube = this;
      requestAnimationFrame(function() {
        var cornerCubeletsOnUpFace = $(cube.domElement).find('.cubeletId-0, .cubeletId-2, .cubeletId-20, .cubeletId-18');
        var cornerStickersOnUpFace = cornerCubeletsOnUpFace.find('.sticker.orange');
        cornerStickersOnUpFace.css('display', 'block');
      });
    }
  });
  
  // Expose a function to do the standard setup on a single g-cube.
  setupGcube = function(gcube) {
    var $gcube = $(gcube);
    var s = $gcube.find('g-speed').text(),
        sc = $gcube.find('g-scramble').text(),
        a = $gcube.find('g-algorithm').text(),
        h = $gcube.find('g-highlight').text(),
        t = $gcube.find('g-text').text(),
        f = $gcube.find('g-florian').text();
    if(f.match(',')){
      f = f.replace(/\s/g).split(',');
    } else {
      f = ['',''];
    }
    $gcube.gcube().gspeed(s).gscramble(sc).galgorithm(a).ghighlight(h).gtext(t).gflorian(f[0],f[1]);
  };
  
  // Expose a function to do the standard setup on all g-cubes.
  setupAllGcubes = function() {
    $('g-cube').each(function() {
      setupGcube(this);
    });
  };
  
  // Wait for the stylesheet to load before rendering, so that the cube won't render improperly during the load.
  var stylesheet = $('<link rel="stylesheet" type="text/css" href="https://molarmanful.github.io/gCube/gcube.css">');  
  stylesheet.load(function() {
    // Construct all of the g-cubes.
    setupAllGcubes();
  });
  $("head").prepend(stylesheet);
}(jQuery));
